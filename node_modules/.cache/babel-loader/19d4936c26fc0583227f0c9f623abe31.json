{"ast":null,"code":"import _slicedToArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectSpread from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nvar _jsxFileName = \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/src/library/common/hooks.js\";\n\n/**\n * Updated by Aaron on 2020-06-10.\n * more eg: https://github.com/streamich/react-use\n */\nimport { useReducer, useContext, useRef, useEffect, useState, createContext, useImperativeHandle } from \"react\";\nimport { bind, clear } from \"size-sensor\";\nimport { onEvent, offEvent, debounce } from \"~utils\";\nexport var Ctx = createContext(function () {});\nexport var StoreCtx = createContext({});\nexport var useTools = function useTools() {\n  return useContext(Ctx);\n};\nexport var useStore = function useStore() {\n  return useContext(StoreCtx);\n};\nexport function useDocumentTitle(title) {\n  var prevTitleRef = useRef(title);\n  useEffect(function () {\n    document.title = title;\n    return function () {\n      // eslint-disable-next-line\n      document.title = prevTitleRef.current;\n    };\n  }, [title]);\n}\nexport function usePrevious(value) {\n  var ref = useRef();\n  useEffect(function () {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n\n  return ref.current;\n}\nexport var useDebounce = function useDebounce(action) {\n  var ms = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 500;\n  var debouncedAction = useRef(null);\n  useEffect(function () {\n    if (!debouncedAction.current) {\n      debouncedAction.current = debounce(action, ms);\n    }\n  }, []);\n  return debouncedAction.current;\n}; // 基于redux的实现，类似于class component的setState 适用于复杂对象模式\n\nexport var useSet = function useSet(initState) {\n  return useReducer(function (state, action) {\n    return _objectSpread(_objectSpread({}, state), action);\n  }, initState);\n}; // 持久化存储 sessionStorage\n\nexport var useStorage = function useStorage() {\n  var initState = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"_root_storage\";\n\n  var getStorage = function getStorage() {\n    var searchStr = sessionStorage.getItem(key);\n\n    if (searchStr) {\n      try {\n        return JSON.parse(searchStr);\n      } catch (error) {\n        return initState;\n      }\n    }\n\n    return initState;\n  };\n\n  var _useState = useState(getStorage()),\n      _useState2 = _slicedToArray(_useState, 2),\n      data = _useState2[0],\n      setData = _useState2[1];\n\n  var setStorage = function setStorage(query) {\n    setData(query);\n    sessionStorage.setItem(key, JSON.stringify(query));\n  };\n\n  return [data, setStorage];\n};\n\nfunction observerDomResize(dom, callback) {\n  var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n  var observer = new MutationObserver(callback);\n  observer.observe(dom, {\n    attributes: true,\n    attributeFilter: [\"style\"],\n    attributeOldValue: true\n  });\n  return observer;\n} // 自动监听视窗大小容器自适应\n\n\nexport var useAutoResize = function useAutoResize(ref) {\n  var _useState3 = useState({\n    width: 0,\n    height: 0\n  }),\n      _useState4 = _slicedToArray(_useState3, 2),\n      state = _useState4[0],\n      setState = _useState4[1];\n\n  var domRef = useRef(null);\n\n  var initWH = function initWH() {\n    if (!domRef.current) return;\n    var _domRef$current = domRef.current,\n        clientWidth = _domRef$current.clientWidth,\n        clientHeight = _domRef$current.clientHeight;\n    setState({\n      width: clientWidth,\n      height: clientHeight\n    });\n  };\n\n  useImperativeHandle(ref, function () {\n    return {\n      initWH: initWH\n    };\n  }, []);\n  useEffect(function () {\n    var debounceSetWHHandler = debounce(initWH, 100, true);\n    debounceSetWHHandler();\n    var domObserver = observerDomResize(domRef.current, debounceSetWHHandler); // bind size\n\n    if (domRef.current) {\n      bind(domRef.current, function (element) {\n        try {\n          var resizeHandler = debounce(function () {\n            var clientWidth = element.clientWidth,\n                clientHeight = element.clientHeight;\n            setState({\n              width: clientWidth,\n              height: clientHeight\n            });\n          }, 100);\n          resizeHandler();\n        } catch (e) {\n          console.warn(\"\\u76D1\\u542C\\u5143\\u7D20dom\\u8282\\u70B9\\u5931\\u8D25, \".concat(e));\n        }\n      });\n    }\n\n    onEvent(window, \"resize\", debounceSetWHHandler);\n    return function () {\n      domObserver.disconnect();\n      domObserver.takeRecords(); // clear size\n\n      if (domRef.current) {\n        try {\n          clear(domRef.current);\n        } catch (e) {\n          console.warn(\"\\u5378\\u8F7D\\u5143\\u7D20dom\\u8282\\u70B9\\u5931\\u8D25, \".concat(e));\n        }\n      }\n\n      offEvent(window, \"resize\", debounceSetWHHandler);\n    };\n  }, []);\n  return _objectSpread(_objectSpread({}, state), {}, {\n    domRef: domRef,\n    initWH: initWH\n  });\n};\nexport function composeProviders() {\n  var _this = this;\n\n  for (var _len = arguments.length, providers = new Array(_len), _key = 0; _key < _len; _key++) {\n    providers[_key] = arguments[_key];\n  }\n\n  return function (_ref) {\n    var children = _ref.children;\n    return providers.reduce(function (prev, Provider) {\n      return /*#__PURE__*/React.createElement(Provider, {\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 65\n        }\n      }, prev);\n    }, children);\n  };\n}","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/图元/react-visual-data/src/library/common/hooks.js"],"names":["useReducer","useContext","useRef","useEffect","useState","createContext","useImperativeHandle","bind","clear","onEvent","offEvent","debounce","Ctx","StoreCtx","useTools","useStore","useDocumentTitle","title","prevTitleRef","document","current","usePrevious","value","ref","useDebounce","action","ms","debouncedAction","useSet","initState","state","useStorage","key","getStorage","searchStr","sessionStorage","getItem","JSON","parse","error","data","setData","setStorage","query","setItem","stringify","observerDomResize","dom","callback","MutationObserver","window","WebKitMutationObserver","MozMutationObserver","observer","observe","attributes","attributeFilter","attributeOldValue","useAutoResize","width","height","setState","domRef","initWH","clientWidth","clientHeight","debounceSetWHHandler","domObserver","element","resizeHandler","e","console","warn","disconnect","takeRecords","composeProviders","providers","children","reduce","prev","Provider"],"mappings":"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","sourcesContent":["/**\n * Updated by Aaron on 2020-06-10.\n * more eg: https://github.com/streamich/react-use\n */\nimport { useReducer, useContext, useRef, useEffect, useState, createContext, useImperativeHandle } from \"react\";\nimport { bind, clear } from \"size-sensor\";\nimport { onEvent, offEvent, debounce } from \"~utils\";\n\nexport const Ctx = createContext(() => {});\nexport const StoreCtx = createContext({});\n\nexport const useTools = () => {\n  return useContext(Ctx);\n};\n\nexport const useStore = () => {\n  return useContext(StoreCtx);\n};\n\nexport function useDocumentTitle(title) {\n  const prevTitleRef = useRef(title);\n  useEffect(() => {\n    document.title = title;\n    return () => {\n      // eslint-disable-next-line\n      document.title = prevTitleRef.current;\n    };\n  }, [title]);\n}\n\nexport function usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n\n  return ref.current;\n}\n\nexport const useDebounce = (action, ms = 500) => {\n  const debouncedAction = useRef(null);\n\n  useEffect(() => {\n    if (!debouncedAction.current) {\n      debouncedAction.current = debounce(action, ms);\n    }\n  }, []);\n\n  return debouncedAction.current;\n};\n\n// 基于redux的实现，类似于class component的setState 适用于复杂对象模式\nexport const useSet = (initState) => useReducer((state, action) => ({ ...state, ...action }), initState);\n\n// 持久化存储 sessionStorage\nexport const useStorage = (initState = {}, key = \"_root_storage\") => {\n  const getStorage = () => {\n    const searchStr = sessionStorage.getItem(key);\n    if (searchStr) {\n      try {\n        return JSON.parse(searchStr);\n      } catch (error) {\n        return initState;\n      }\n    }\n    return initState;\n  };\n\n  const [data, setData] = useState(getStorage());\n  const setStorage = (query) => {\n    setData(query);\n    sessionStorage.setItem(key, JSON.stringify(query));\n  };\n  return [data, setStorage];\n};\n\nfunction observerDomResize(dom, callback) {\n  const MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n\n  const observer = new MutationObserver(callback);\n\n  observer.observe(dom, {\n    attributes: true,\n    attributeFilter: [\"style\"],\n    attributeOldValue: true\n  });\n\n  return observer;\n}\n\n// 自动监听视窗大小容器自适应\nexport const useAutoResize = (ref) => {\n  const [state, setState] = useState({ width: 0, height: 0 });\n\n  const domRef = useRef(null);\n\n  const initWH = () => {\n    if (!domRef.current) return;\n    const { clientWidth, clientHeight } = domRef.current;\n    setState({ width: clientWidth, height: clientHeight });\n  };\n\n  useImperativeHandle(ref, () => ({ initWH }), []);\n\n  useEffect(() => {\n    const debounceSetWHHandler = debounce(initWH, 100, true);\n    debounceSetWHHandler();\n\n    const domObserver = observerDomResize(domRef.current, debounceSetWHHandler);\n\n    // bind size\n    if (domRef.current) {\n      bind(domRef.current, (element) => {\n        try {\n          const resizeHandler = debounce(() => {\n            const { clientWidth, clientHeight } = element;\n            setState({ width: clientWidth, height: clientHeight });\n          }, 100);\n\n          resizeHandler();\n        } catch (e) {\n          console.warn(`监听元素dom节点失败, ${e}`);\n        }\n      });\n    }\n\n    onEvent(window, \"resize\", debounceSetWHHandler);\n\n    return () => {\n      domObserver.disconnect();\n      domObserver.takeRecords();\n      // clear size\n      if (domRef.current) {\n        try {\n          clear(domRef.current);\n        } catch (e) {\n          console.warn(`卸载元素dom节点失败, ${e}`);\n        }\n      }\n      offEvent(window, \"resize\", debounceSetWHHandler);\n    };\n  }, []);\n\n  return { ...state, domRef, initWH };\n};\n\nexport function composeProviders(...providers) {\n  return ({ children }) => providers.reduce((prev, Provider) => <Provider>{prev}</Provider>, children);\n}\n"]},"metadata":{},"sourceType":"module"}