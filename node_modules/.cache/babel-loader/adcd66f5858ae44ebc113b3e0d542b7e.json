{"ast":null,"code":"import \"antd/es/upload/style\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _regeneratorRuntime from \"/Users/xiangmingxin/Wicrecend/Primitives/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport _asyncToGenerator from \"/Users/xiangmingxin/Wicrecend/Primitives/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/Primitives/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/Primitives/src/materials/form/upload/index.js\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { UploadOutlined } from \"@ant-design/icons\";\nimport { isEmpty, getBase64 } from \"~utils/helper\";\n\nvar VUpload = function VUpload(p) {\n  var _p$options;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      fileList = _useState2[0],\n      setFileList = _useState2[1]; // 获取到文件名\n\n\n  var fileName = function fileName(name) {\n    var pos = name.lastIndexOf(\"/\");\n    return name.substring(pos + 1);\n  };\n\n  useEffect(function () {\n    // 实际上传地址\n    if (isEmpty(p.value)) return;\n    setFileList([{\n      uid: \"1\",\n      status: \"done\",\n      name: fileName(p.value),\n      url: p.value\n    }]);\n  }, []);\n  var renderProps = {\n    name: \"file\",\n    action: p.action,\n    enctype: \"multipart/form-data\",\n    withCredentials: true,\n    listType: ((_p$options = p.options) === null || _p$options === void 0 ? void 0 : _p$options.listType) || \"picture\",\n    type: \"file\",\n    fileList: fileList,\n    onChange: function () {\n      var _onChange = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(info) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (info.file.url) {\n                  _context.next = 4;\n                  break;\n                }\n\n                _context.next = 3;\n                return getBase64(info.file.originFileObj);\n\n              case 3:\n                info.file.url = _context.sent;\n\n              case 4:\n                if (info.file.status === \"done\") {\n                  _message.success(\"\".concat(info.file.name, \" \\u6587\\u4EF6\\u4E0A\\u4F20\\u6210\\u529F\"));\n\n                  setFileList([{\n                    uid: \"1\",\n                    status: \"done\",\n                    name: info.file.name,\n                    url: info.file.url\n                  }]);\n                  p.onChange(p.name, info.file.url);\n                } else if (info.file.status === \"error\") {\n                  _message.error(\"\".concat(info.file.name, \" \\u6587\\u4EF6\\u4E0A\\u4F20\\u5931\\u8D25\"));\n\n                  setFileList([]);\n                  p.onChange(p.name, \"\");\n                }\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onChange(_x) {\n        return _onChange.apply(this, arguments);\n      }\n\n      return onChange;\n    }(),\n    onRemove: function onRemove() {\n      setFileList([]);\n      p.onChange(p.name, \"\");\n    }\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-upload-mod\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(_Upload, Object.assign({}, renderProps, p.options, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(_Button, {\n    disabled: fileList.length >= 1,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(UploadOutlined, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 11\n    }\n  }), \" \\u4E0A\\u4F20\")));\n};\n\nexport default VUpload;","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/Primitives/src/materials/form/upload/index.js"],"names":["React","useState","useEffect","UploadOutlined","isEmpty","getBase64","VUpload","p","fileList","setFileList","fileName","name","pos","lastIndexOf","substring","value","uid","status","url","renderProps","action","enctype","withCredentials","listType","options","type","onChange","info","file","originFileObj","success","error","onRemove","length"],"mappings":";;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AAEA,SAASC,cAAT,QAA+B,mBAA/B;AACA,SAASC,OAAT,EAAkBC,SAAlB,QAAmC,eAAnC;;AAEA,IAAMC,OAAO,GAAG,SAAVA,OAAU,CAACC,CAAD,EAAO;AAAA;;AAAA,kBACWN,QAAQ,CAAC,EAAD,CADnB;AAAA;AAAA,MACdO,QADc;AAAA,MACJC,WADI,kBAErB;;;AACA,MAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACC,IAAD,EAAU;AACzB,QAAIC,GAAG,GAAGD,IAAI,CAACE,WAAL,CAAiB,GAAjB,CAAV;AACA,WAAOF,IAAI,CAACG,SAAL,CAAeF,GAAG,GAAG,CAArB,CAAP;AACD,GAHD;;AAKAV,EAAAA,SAAS,CAAC,YAAM;AACd;AACA,QAAIE,OAAO,CAACG,CAAC,CAACQ,KAAH,CAAX,EAAsB;AACtBN,IAAAA,WAAW,CAAC,CACV;AACEO,MAAAA,GAAG,EAAE,GADP;AAEEC,MAAAA,MAAM,EAAE,MAFV;AAGEN,MAAAA,IAAI,EAAED,QAAQ,CAACH,CAAC,CAACQ,KAAH,CAHhB;AAIEG,MAAAA,GAAG,EAAEX,CAAC,CAACQ;AAJT,KADU,CAAD,CAAX;AAQD,GAXQ,EAWN,EAXM,CAAT;AAaA,MAAMI,WAAW,GAAG;AAClBR,IAAAA,IAAI,EAAE,MADY;AAElBS,IAAAA,MAAM,EAAEb,CAAC,CAACa,MAFQ;AAGlBC,IAAAA,OAAO,EAAE,qBAHS;AAIlBC,IAAAA,eAAe,EAAE,IAJC;AAKlBC,IAAAA,QAAQ,EAAE,eAAAhB,CAAC,CAACiB,OAAF,0DAAWD,QAAX,KAAuB,SALf;AAMlBE,IAAAA,IAAI,EAAE,MANY;AAOlBjB,IAAAA,QAAQ,EAAEA,QAPQ;AAQlBkB,IAAAA,QAAQ;AAAA,+EAAE,iBAAOC,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA,oBAEHA,IAAI,CAACC,IAAL,CAAUV,GAFP;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAGgBb,SAAS,CAACsB,IAAI,CAACC,IAAL,CAAUC,aAAX,CAHzB;;AAAA;AAGNF,gBAAAA,IAAI,CAACC,IAAL,CAAUV,GAHJ;;AAAA;AAKR,oBAAIS,IAAI,CAACC,IAAL,CAAUX,MAAV,KAAqB,MAAzB,EAAiC;AAC/B,2BAAQa,OAAR,WAAmBH,IAAI,CAACC,IAAL,CAAUjB,IAA7B;;AACAF,kBAAAA,WAAW,CAAC,CACV;AACEO,oBAAAA,GAAG,EAAE,GADP;AAEEC,oBAAAA,MAAM,EAAE,MAFV;AAGEN,oBAAAA,IAAI,EAAEgB,IAAI,CAACC,IAAL,CAAUjB,IAHlB;AAIEO,oBAAAA,GAAG,EAAES,IAAI,CAACC,IAAL,CAAUV;AAJjB,mBADU,CAAD,CAAX;AAQAX,kBAAAA,CAAC,CAACmB,QAAF,CAAWnB,CAAC,CAACI,IAAb,EAAmBgB,IAAI,CAACC,IAAL,CAAUV,GAA7B;AACD,iBAXD,MAWO,IAAIS,IAAI,CAACC,IAAL,CAAUX,MAAV,KAAqB,OAAzB,EAAkC;AACvC,2BAAQc,KAAR,WAAiBJ,IAAI,CAACC,IAAL,CAAUjB,IAA3B;;AACAF,kBAAAA,WAAW,CAAC,EAAD,CAAX;AACAF,kBAAAA,CAAC,CAACmB,QAAF,CAAWnB,CAAC,CAACI,IAAb,EAAmB,EAAnB;AACD;;AApBO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,OARU;AA8BlBqB,IAAAA,QA9BkB,sBA8BP;AACTvB,MAAAA,WAAW,CAAC,EAAD,CAAX;AACAF,MAAAA,CAAC,CAACmB,QAAF,CAAWnB,CAAC,CAACI,IAAb,EAAmB,EAAnB;AACD;AAjCiB,GAApB;AAoCA,sBACE;AAAK,IAAA,SAAS,EAAC,eAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,+CAAYQ,WAAZ,EAA6BZ,CAAC,CAACiB,OAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACE;AAAQ,IAAA,QAAQ,EAAEhB,QAAQ,CAACyB,MAAT,IAAmB,CAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACE,oBAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADF,kBADF,CADF,CADF;AASD,CAlED;;AAoEA,eAAe3B,OAAf","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Upload, message, Button } from \"antd\";\nimport { UploadOutlined } from \"@ant-design/icons\";\nimport { isEmpty, getBase64 } from \"~utils/helper\";\n\nconst VUpload = (p) => {\n  const [fileList, setFileList] = useState([]);\n  // 获取到文件名\n  const fileName = (name) => {\n    let pos = name.lastIndexOf(\"/\");\n    return name.substring(pos + 1);\n  };\n\n  useEffect(() => {\n    // 实际上传地址\n    if (isEmpty(p.value)) return;\n    setFileList([\n      {\n        uid: \"1\",\n        status: \"done\",\n        name: fileName(p.value),\n        url: p.value\n      }\n    ]);\n  }, []);\n\n  const renderProps = {\n    name: \"file\",\n    action: p.action,\n    enctype: \"multipart/form-data\",\n    withCredentials: true,\n    listType: p.options?.listType || \"picture\",\n    type: \"file\",\n    fileList: fileList,\n    onChange: async (info) => {\n      // 转化为base64格式数据，真实地址为info.file.response.url\n      if (!info.file.url) {\n        info.file.url = await getBase64(info.file.originFileObj);\n      }\n      if (info.file.status === \"done\") {\n        message.success(`${info.file.name} 文件上传成功`);\n        setFileList([\n          {\n            uid: \"1\",\n            status: \"done\",\n            name: info.file.name,\n            url: info.file.url\n          }\n        ]);\n        p.onChange(p.name, info.file.url);\n      } else if (info.file.status === \"error\") {\n        message.error(`${info.file.name} 文件上传失败`);\n        setFileList([]);\n        p.onChange(p.name, \"\");\n      }\n    },\n    onRemove() {\n      setFileList([]);\n      p.onChange(p.name, \"\");\n    }\n  };\n\n  return (\n    <div className=\"gc-upload-mod\">\n      <Upload {...renderProps} {...p.options}>\n        <Button disabled={fileList.length >= 1}>\n          <UploadOutlined /> 上传\n        </Button>\n      </Upload>\n    </div>\n  );\n};\n\nexport default VUpload;\n"]},"metadata":{},"sourceType":"module"}