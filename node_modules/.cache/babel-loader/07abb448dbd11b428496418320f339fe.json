{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/card/style\";\nimport _Card from \"antd/es/card\";\nimport \"antd/es/tabs/style\";\nimport _Tabs from \"antd/es/tabs\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport _objectSpread from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/src/materials/dialog/index.js\";\nimport React, { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Scrollbar } from \"~components\";\nimport { SchemaRender, AxureParser } from \"~renderer\";\nimport fetcher from \"~materials/hoc\";\nimport subSchemaJson from \"./schema-json\"; // reset form fields when modal is dirlldown, closed\n\nfunction WithDialog(props) {\n  var _value$data,\n      _this = this;\n\n  var visible = props.visible,\n      value = props.value,\n      mode = props.mode,\n      onCancel = props.onCancel,\n      onRowValueChange = props.onRowValueChange;\n\n  var _useState = useState(\"base\"),\n      _useState2 = _slicedToArray(_useState, 2),\n      keys = _useState2[0],\n      setKeys = _useState2[1];\n\n  var _useState3 = useState({\n    cname: \"\",\n    value: {},\n    schema: []\n  }),\n      _useState4 = _slicedToArray(_useState3, 2),\n      currentField = _useState4[0],\n      setField = _useState4[1];\n\n  var isDevelop = mode === \"development\";\n  var calculateWidth = \"\".concat(((_value$data = value.data) === null || _value$data === void 0 ? void 0 : _value$data.width) / 12 * 100, \"%\");\n  var modalStyle = {\n    maxWidth: \"100vw\",\n    minWidth: 800,\n    minHeight: 300,\n    paddingBottom: 0\n  };\n  var footer = useMemo(function () {\n    var _React$createElement;\n\n    return isDevelop ? [/*#__PURE__*/React.createElement(_Button, (_React$createElement = {\n      key: \"back\"\n    }, _defineProperty(_React$createElement, \"key\", \"submit\"), _defineProperty(_React$createElement, \"type\", \"primary\"), _defineProperty(_React$createElement, \"onClick\", onCancel), _defineProperty(_React$createElement, \"__self\", _this), _defineProperty(_React$createElement, \"__source\", {\n      fileName: _jsxFileName,\n      lineNumber: 32,\n      columnNumber: 11\n    }), _React$createElement), \"\\u786E\\u5B9A\")] : null;\n  }, [isDevelop]);\n  var onDialogChange = useCallback(function (val) {\n    if (!onRowValueChange) return;\n\n    var rootValue = _objectSpread({}, val); // 联动、下钻参数变更\n\n\n    if (val.drillDownOpen) {\n      rootValue = _objectSpread(_objectSpread({}, rootValue), {}, {\n        dependenceOpen: !val.drillDownOpen\n      });\n    }\n\n    if (val.dependenceOpen) {\n      rootValue = _objectSpread(_objectSpread({}, rootValue), {}, {\n        drillDownOpen: !val.dependenceOpen\n      });\n    }\n\n    onRowValueChange(rootValue, value.data.drillDownLevel);\n  }, [onRowValueChange]);\n  useEffect(function () {\n    visible && setKeys(\"base\");\n  }, [visible]);\n  useEffect(function () {\n    try {\n      // TODO: 获取物料组件配置项\n      var currentFieldSchema = subSchemaJson.find(function (o) {\n        return o.materials === value.type;\n      }).fields;\n      setField({\n        cname: value.type,\n        value: value.data,\n        schema: currentFieldSchema\n      });\n    } catch (error) {\n      console.warn(\"error message. \".concat(error));\n    }\n  }, [value.uniqueId]);\n  return /*#__PURE__*/React.createElement(_Modal, {\n    title: value.data.title || \"未命名\",\n    forceRender: true,\n    visible: visible,\n    destroyOnClose: true,\n    maskClosable: false,\n    onCancel: onCancel,\n    footer: footer,\n    width: calculateWidth,\n    style: modalStyle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(_Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }\n  }, isDevelop ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Col, {\n    span: 16,\n    style: {\n      height: value.data.height || 300\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(AxureParser, {\n    value: value,\n    onRowValueChange: onRowValueChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(_Col, {\n    span: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Card, {\n    title: \"\\u63A7\\u5236\\u9762\\u677F\",\n    bodyStyle: {\n      padding: \"0 15px\",\n      fontSize: 12,\n      minHeight: 600\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(_Tabs, {\n    activeKey: keys,\n    onTabClick: function onTabClick(key) {\n      setKeys(key);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 17\n    }\n  }, currentField.schema.map(function (item) {\n    return /*#__PURE__*/React.createElement(_Tabs.TabPane, {\n      tab: item.name,\n      key: item.key,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Scrollbar, {\n      height: 600,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 23\n      }\n    }, keys === item.key && /*#__PURE__*/React.createElement(SchemaRender, {\n      cname: currentField.cname,\n      schema: item.schema,\n      formData: currentField.value,\n      onChange: onDialogChange,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 27\n      }\n    })));\n  }))))) : /*#__PURE__*/React.createElement(_Col, {\n    span: 24,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AxureParser, {\n    value: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 13\n    }\n  }))));\n}\n\nexport default connect(function (state) {\n  return state.component;\n})(fetcher(WithDialog));","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/图元/react-visual-data/src/materials/dialog/index.js"],"names":["React","useState","useEffect","useCallback","useMemo","connect","Scrollbar","SchemaRender","AxureParser","fetcher","subSchemaJson","WithDialog","props","visible","value","mode","onCancel","onRowValueChange","keys","setKeys","cname","schema","currentField","setField","isDevelop","calculateWidth","data","width","modalStyle","maxWidth","minWidth","minHeight","paddingBottom","footer","onDialogChange","val","rootValue","drillDownOpen","dependenceOpen","drillDownLevel","currentFieldSchema","find","o","materials","type","fields","error","console","warn","uniqueId","title","height","padding","fontSize","key","map","item","name","state","component"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback, useMemo } from \"react\";\nimport { Button, Modal, Tabs, Row, Col, Card } from \"antd\";\nimport { connect } from \"react-redux\";\nimport { Scrollbar } from \"~components\";\nimport { SchemaRender, AxureParser } from \"~renderer\";\nimport fetcher from \"~materials/hoc\";\nimport subSchemaJson from \"./schema-json\";\n\n// reset form fields when modal is dirlldown, closed\nfunction WithDialog(props) {\n  const { visible, value, mode, onCancel, onRowValueChange } = props;\n  const [keys, setKeys] = useState(\"base\");\n  const [currentField, setField] = useState({\n    cname: \"\",\n    value: {},\n    schema: []\n  });\n\n  const isDevelop = mode === \"development\";\n  const calculateWidth = `${(value.data?.width / 12) * 100}%`;\n\n  const modalStyle = {\n    maxWidth: \"100vw\",\n    minWidth: 800,\n    minHeight: 300,\n    paddingBottom: 0\n  };\n\n  const footer = useMemo(() => {\n    return isDevelop\n      ? [\n          <Button key=\"back\" key=\"submit\" type=\"primary\" onClick={onCancel}>\n            确定\n          </Button>\n        ]\n      : null;\n  }, [isDevelop]);\n\n  const onDialogChange = useCallback(\n    (val) => {\n      if (!onRowValueChange) return;\n      let rootValue = { ...val };\n\n      // 联动、下钻参数变更\n      if (val.drillDownOpen) {\n        rootValue = {\n          ...rootValue,\n          dependenceOpen: !val.drillDownOpen\n        };\n      }\n\n      if (val.dependenceOpen) {\n        rootValue = {\n          ...rootValue,\n          drillDownOpen: !val.dependenceOpen\n        };\n      }\n      onRowValueChange(rootValue, value.data.drillDownLevel);\n    },\n    [onRowValueChange]\n  );\n\n  useEffect(() => {\n    visible && setKeys(\"base\");\n  }, [visible]);\n\n  useEffect(() => {\n    try {\n      // TODO: 获取物料组件配置项\n      const currentFieldSchema = subSchemaJson.find((o) => o.materials === value.type).fields;\n\n      setField({\n        cname: value.type,\n        value: value.data,\n        schema: currentFieldSchema\n      });\n    } catch (error) {\n      console.warn(`error message. ${error}`);\n    }\n  }, [value.uniqueId]);\n\n  return (\n    <Modal\n      title={value.data.title || \"未命名\"}\n      forceRender={true}\n      visible={visible}\n      destroyOnClose={true}\n      maskClosable={false}\n      onCancel={onCancel}\n      footer={footer}\n      width={calculateWidth}\n      style={modalStyle}\n    >\n      <Row>\n        {isDevelop ? (\n          <>\n            <Col span={16} style={{ height: value.data.height || 300 }}>\n              <AxureParser value={value} onRowValueChange={onRowValueChange} />\n            </Col>\n            <Col span={8}>\n              <Card\n                title=\"控制面板\"\n                bodyStyle={{\n                  padding: \"0 15px\",\n                  fontSize: 12,\n                  minHeight: 600\n                }}\n              >\n                <Tabs\n                  activeKey={keys}\n                  onTabClick={(key) => {\n                    setKeys(key);\n                  }}\n                >\n                  {currentField.schema.map((item) => (\n                    <Tabs.TabPane tab={item.name} key={item.key}>\n                      <Scrollbar height={600}>\n                        {keys === item.key && (\n                          <SchemaRender\n                            cname={currentField.cname}\n                            schema={item.schema}\n                            formData={currentField.value}\n                            onChange={onDialogChange}\n                          />\n                        )}\n                      </Scrollbar>\n                    </Tabs.TabPane>\n                  ))}\n                </Tabs>\n              </Card>\n            </Col>\n          </>\n        ) : (\n          <Col span={24}>\n            <AxureParser value={value} />\n          </Col>\n        )}\n      </Row>\n    </Modal>\n  );\n}\n\nexport default connect((state) => state.component)(fetcher(WithDialog));\n"]},"metadata":{},"sourceType":"module"}