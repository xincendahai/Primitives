{"ast":null,"code":"import \"antd/es/drawer/style\";\nimport _Drawer from \"antd/es/drawer\";\nimport \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/row/style\";\nimport _Row from \"antd/es/row\";\nimport \"antd/es/col/style\";\nimport _Col from \"antd/es/col\";\nimport \"antd/es/divider/style\";\nimport _Divider from \"antd/es/divider\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/src/materials/dynamic-data/index.js\";\n\nimport React, { Fragment, useRef, useEffect, createContext } from \"react\";\nimport { connect } from \"react-redux\";\nimport { MonacoEditor } from \"~components\";\nimport { useSet } from \"~common/hooks\";\nimport { echartBarAPI } from \"@/api\";\nvar Option = _Select.Option;\nvar Compose = createContext();\nvar layout = {\n  labelCol: {\n    span: 24\n  },\n  wrapperCol: {\n    span: 24\n  }\n};\n/**\n * 数据管理数据\n * @param {value} 数据\n * @param {onChange} 通过刷新数据改变\n */\n\nvar DataSource = function DataSource(_ref) {\n  var name = _ref.name,\n      value = _ref.value,\n      options = _ref.options,\n      onChange = _ref.onChange,\n      api = _ref.api,\n      sql = _ref.sql;\n  var codeRef = useRef();\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  var _useSet = useSet({\n    typeOf: \"json\",\n    visible: false,\n    visible1: false,\n    disabled: true,\n    code: {\n      data: null\n    },\n    apiValue: null,\n    apiList: api,\n    sqlValue: null,\n    sqlList: sql\n  }),\n      _useSet2 = _slicedToArray(_useSet, 2),\n      state = _useSet2[0],\n      dispath = _useSet2[1];\n\n  useEffect(function () {\n    dispath({\n      typeOf: value.dataType,\n      code: value.data\n    });\n  }, []);\n\n  var handleOk = function handleOk() {\n    echartBarAPI({\n      code: \"// try to write code somewhere 😈\"\n    }).then(function (res) {\n      dispath({\n        disabled: false,\n        code: res.data\n      });\n    });\n  };\n\n  var handleChange = function handleChange(value) {\n    dispath({\n      typeOf: value\n    });\n  };\n\n  var onChangeApi = function onChangeApi(value) {\n    var result = state.apiList.find(function (item) {\n      return item.id === value;\n    }).data;\n    dispath({\n      apiValue: value,\n      code: result\n    });\n  };\n\n  var onChangeSql = function onChangeSql(value) {\n    var result = state.sqlList.find(function (item) {\n      return item.id === value;\n    }).data;\n    dispath({\n      sqlValue: value,\n      code: result\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Compose.Provider, {\n    value: {\n      state: state,\n      dispath: dispath\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(_Form, Object.assign({}, layout, {\n    form: form,\n    style: {\n      marginTop: 5\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(_Form.Item, {\n    label: \"\\u6570\\u636E\\u6E90\\u7C7B\\u578B\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(_Select, {\n    value: state.typeOf,\n    onChange: handleChange,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Option, {\n    value: \"json\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 13\n    }\n  }, \"JSON\\u6570\\u636E\"), /*#__PURE__*/React.createElement(Option, {\n    value: \"api\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 13\n    }\n  }, \"API\\u63A5\\u53E3\"), /*#__PURE__*/React.createElement(Option, {\n    value: \"sql\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 13\n    }\n  }, \"MySQL\\u6570\\u636E\\u5E93\"))), state.typeOf === \"json\" && /*#__PURE__*/React.createElement(Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(MonacoEditor, {\n    ref: codeRef,\n    height: options.height,\n    language: \"json\",\n    value: value.data,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(_Space, {\n    size: \"small\",\n    style: {\n      marginTop: 10\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      dispath({\n        visible1: true,\n        code: codeRef.current.getValue()\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 15\n    }\n  }, \"\\u8C03\\u8BD5\"), /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      var _value = Object.assign(value, {\n        dataType: state.typeOf,\n        data: codeRef.current.getValue()\n      });\n\n      onChange(name, _value);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 15\n    }\n  }, \"\\u5237\\u65B0\\u6570\\u636E\"))), state.typeOf === \"api\" && /*#__PURE__*/React.createElement(_Form.Item, {\n    label: \"\\u6570\\u636E\\u6A21\\u578B\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Select, {\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u6570\\u636E\\u6A21\\u578B\",\n    defaultValue: state.apiValue,\n    showSearch: true,\n    filterOption: function filterOption(input, option) {\n      return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0;\n    },\n    onChange: onChangeApi,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 13\n    }\n  }, state.apiList.map(function (item) {\n    return /*#__PURE__*/React.createElement(Option, {\n      key: item.id,\n      value: item.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }\n    }, item.name);\n  })), /*#__PURE__*/React.createElement(_Space, {\n    size: \"small\",\n    style: {\n      marginTop: 15\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      dispath({\n        visible1: true\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 15\n    }\n  }, \"\\u8C03\\u8BD5\"), /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      var _value = Object.assign(value, {\n        dataType: state.typeOf,\n        data: state.code\n      });\n\n      onChange(name, _value);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 15\n    }\n  }, \"\\u5237\\u65B0\\u6570\\u636E\"))), state.typeOf === \"sql\" && /*#__PURE__*/React.createElement(_Form.Item, {\n    label: \"\\u6570\\u636E\\u6A21\\u578B\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Select, {\n    placeholder: \"\\u8BF7\\u9009\\u62E9\\u6570\\u636E\\u6A21\\u578B\",\n    defaultValue: state.sqlValue,\n    showSearch: true,\n    filterOption: function filterOption(input, option) {\n      return option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0;\n    },\n    onChange: onChangeSql,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }\n  }, state.sqlList.map(function (item) {\n    return /*#__PURE__*/React.createElement(Option, {\n      key: item.id,\n      value: item.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }\n    }, item.name);\n  })), /*#__PURE__*/React.createElement(_Space, {\n    size: \"small\",\n    style: {\n      marginTop: 15\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      dispath({\n        visible: true,\n        disabled: true\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 15\n    }\n  }, \"\\u67E5\\u8BE2\"), /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    onClick: function onClick() {\n      dispath({\n        visible1: true\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 15\n    }\n  }, \"\\u8C03\\u8BD5\")))), /*#__PURE__*/React.createElement(_Modal, {\n    visible: state.visible,\n    width: 1080,\n    destroyOnClose: true,\n    closable: false,\n    title: \"\\u8BF7\\u6C42\\u6570\\u636E\",\n    footer: [/*#__PURE__*/React.createElement(_Button, {\n      key: \"request\",\n      type: \"dashed\",\n      onClick: handleOk,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }\n    }, \"\\u8C03\\u8BD5\"), /*#__PURE__*/React.createElement(_Button, {\n      key: \"cancel\",\n      onClick: function onClick() {\n        dispath({\n          visible: false,\n          code: {\n            data: null\n          }\n        });\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }\n    }, \"\\u53D6\\u6D88\"), /*#__PURE__*/React.createElement(_Button, {\n      key: \"ok\",\n      type: \"primary\",\n      disabled: state.disabled,\n      onClick: function onClick() {\n        dispath({\n          visible: false,\n          code: {\n            data: null\n          }\n        });\n        onChange(state.code);\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 11\n      }\n    }, \"\\u66F4\\u65B0\")],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(_Row, {\n    gutter: [16, 16],\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(_Col, {\n    span: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 242,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Divider, {\n    orientation: \"left\",\n    plain: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }\n  }, \"\\u67E5\\u8BE2\\u8868\\u8FBE\\u5F0F\"), /*#__PURE__*/React.createElement(MonacoEditor, {\n    height: 300,\n    language: \"mysql\",\n    value: \"// try to write code somewhere \\uD83D\\uDE08\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(_Col, {\n    span: 12,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Divider, {\n    orientation: \"left\",\n    plain: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 13\n    }\n  }, \"\\u683C\\u5F0F\\u5316\\u540E\\u7ED3\\u679C\"), /*#__PURE__*/React.createElement(MonacoEditor, {\n    height: 300,\n    value: state.code,\n    readOnly: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }\n  })))), /*#__PURE__*/React.createElement(_Drawer, {\n    visible: state.visible1,\n    title: \"\\u6570\\u636E\\u54CD\\u5E94\\u7ED3\\u679C\",\n    width: 400,\n    placement: \"right\",\n    onClose: function onClose() {\n      dispath({\n        visible1: false\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MonacoEditor, {\n    height: 800,\n    value: state.code,\n    readOnly: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default connect(function (state) {\n  return {\n    api: state.component.api,\n    sql: state.component.sql\n  };\n})(DataSource);","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/图元/react-visual-data/src/materials/dynamic-data/index.js"],"names":["React","Fragment","useRef","useEffect","createContext","connect","MonacoEditor","useSet","echartBarAPI","Option","Compose","layout","labelCol","span","wrapperCol","DataSource","name","value","options","onChange","api","sql","codeRef","useForm","form","typeOf","visible","visible1","disabled","code","data","apiValue","apiList","sqlValue","sqlList","state","dispath","dataType","handleOk","then","res","handleChange","onChangeApi","result","find","item","id","onChangeSql","marginTop","height","current","getValue","_value","Object","assign","input","option","children","toLowerCase","indexOf","map","component"],"mappings":"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","sourcesContent":["import React, { Fragment, useRef, useEffect, createContext } from \"react\";\nimport { Modal, Drawer, Space, Button, Divider, Row, Col, Select, Form } from \"antd\";\nimport { connect } from \"react-redux\";\nimport { MonacoEditor } from \"~components\";\nimport { useSet } from \"~common/hooks\";\nimport { echartBarAPI } from \"@/api\";\n\nconst { Option } = Select;\nconst Compose = createContext();\nconst layout = {\n  labelCol: {\n    span: 24\n  },\n  wrapperCol: {\n    span: 24\n  }\n};\n\n/**\n * 数据管理数据\n * @param {value} 数据\n * @param {onChange} 通过刷新数据改变\n */\nconst DataSource = ({ name, value, options, onChange, api, sql }) => {\n  const codeRef = useRef();\n  const [form] = Form.useForm();\n  const [state, dispath] = useSet({\n    typeOf: \"json\",\n    visible: false,\n    visible1: false,\n    disabled: true,\n    code: { data: null },\n    apiValue: null,\n    apiList: api,\n    sqlValue: null,\n    sqlList: sql\n  });\n\n  useEffect(() => {\n    dispath({\n      typeOf: value.dataType,\n      code: value.data\n    });\n  }, []);\n\n  const handleOk = () => {\n    echartBarAPI({ code: \"// try to write code somewhere 😈\" }).then((res) => {\n      dispath({\n        disabled: false,\n        code: res.data\n      });\n    });\n  };\n\n  const handleChange = (value) => {\n    dispath({\n      typeOf: value\n    });\n  };\n\n  const onChangeApi = (value) => {\n    const result = state.apiList.find((item) => item.id === value).data;\n    dispath({\n      apiValue: value,\n      code: result\n    });\n  };\n\n  const onChangeSql = (value) => {\n    const result = state.sqlList.find((item) => item.id === value).data;\n    dispath({\n      sqlValue: value,\n      code: result\n    });\n  };\n\n  return (\n    <Compose.Provider value={{ state, dispath }}>\n      <Form {...layout} form={form} style={{ marginTop: 5 }}>\n        <Form.Item label=\"数据源类型\">\n          <Select value={state.typeOf} onChange={handleChange}>\n            <Option value=\"json\">JSON数据</Option>\n            <Option value=\"api\">API接口</Option>\n            <Option value=\"sql\">MySQL数据库</Option>\n          </Select>\n        </Form.Item>\n        {state.typeOf === \"json\" && (\n          <Fragment>\n            <MonacoEditor ref={codeRef} height={options.height} language=\"json\" value={value.data} />\n            <Space size=\"small\" style={{ marginTop: 10 }}>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  dispath({\n                    visible1: true,\n                    code: codeRef.current.getValue()\n                  });\n                }}\n              >\n                调试\n              </Button>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  let _value = Object.assign(value, {\n                    dataType: state.typeOf,\n                    data: codeRef.current.getValue()\n                  });\n                  onChange(name, _value);\n                }}\n              >\n                刷新数据\n              </Button>\n            </Space>\n          </Fragment>\n        )}\n\n        {state.typeOf === \"api\" && (\n          <Form.Item label=\"数据模型\">\n            <Select\n              placeholder=\"请选择数据模型\"\n              defaultValue={state.apiValue}\n              showSearch\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\n              onChange={onChangeApi}\n            >\n              {state.apiList.map((item) => (\n                <Option key={item.id} value={item.id}>\n                  {item.name}\n                </Option>\n              ))}\n            </Select>\n            <Space size=\"small\" style={{ marginTop: 15 }}>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  dispath({\n                    visible1: true\n                  });\n                }}\n              >\n                调试\n              </Button>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  let _value = Object.assign(value, {\n                    dataType: state.typeOf,\n                    data: state.code\n                  });\n                  onChange(name, _value);\n                }}\n              >\n                刷新数据\n              </Button>\n            </Space>\n          </Form.Item>\n        )}\n\n        {state.typeOf === \"sql\" && (\n          <Form.Item label=\"数据模型\">\n            <Select\n              placeholder=\"请选择数据模型\"\n              defaultValue={state.sqlValue}\n              showSearch\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\n              onChange={onChangeSql}\n            >\n              {state.sqlList.map((item) => (\n                <Option key={item.id} value={item.id}>\n                  {item.name}\n                </Option>\n              ))}\n            </Select>\n\n            <Space size=\"small\" style={{ marginTop: 15 }}>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  dispath({\n                    visible: true,\n                    disabled: true\n                  });\n                }}\n              >\n                查询\n              </Button>\n              <Button\n                type=\"primary\"\n                onClick={() => {\n                  dispath({\n                    visible1: true\n                  });\n                }}\n              >\n                调试\n              </Button>\n            </Space>\n          </Form.Item>\n        )}\n      </Form>\n      {/* 查询 */}\n      <Modal\n        visible={state.visible}\n        width={1080}\n        destroyOnClose={true}\n        closable={false}\n        title=\"请求数据\"\n        footer={[\n          <Button key=\"request\" type=\"dashed\" onClick={handleOk}>\n            调试\n          </Button>,\n          <Button\n            key=\"cancel\"\n            onClick={() => {\n              dispath({\n                visible: false,\n                code: { data: null }\n              });\n            }}\n          >\n            取消\n          </Button>,\n          <Button\n            key=\"ok\"\n            type=\"primary\"\n            disabled={state.disabled}\n            onClick={() => {\n              dispath({\n                visible: false,\n                code: { data: null }\n              });\n\n              onChange(state.code);\n            }}\n          >\n            更新\n          </Button>\n        ]}\n      >\n        <Row gutter={[16, 16]}>\n          <Col span={12}>\n            <Divider orientation=\"left\" plain>\n              查询表达式\n            </Divider>\n            <MonacoEditor height={300} language=\"mysql\" value=\"// try to write code somewhere 😈\" />\n          </Col>\n          <Col span={12}>\n            <Divider orientation=\"left\" plain>\n              格式化后结果\n            </Divider>\n            <MonacoEditor height={300} value={state.code} readOnly={true} />\n          </Col>\n        </Row>\n      </Modal>\n      {/* 调试 */}\n      <Drawer\n        visible={state.visible1}\n        title=\"数据响应结果\"\n        width={400}\n        placement=\"right\"\n        onClose={() => {\n          dispath({ visible1: false });\n        }}\n      >\n        <MonacoEditor height={800} value={state.code} readOnly={true} />\n      </Drawer>\n    </Compose.Provider>\n  );\n};\n\nexport default connect((state) => ({\n  api: state.component.api,\n  sql: state.component.sql\n}))(DataSource);\n"]},"metadata":{},"sourceType":"module"}