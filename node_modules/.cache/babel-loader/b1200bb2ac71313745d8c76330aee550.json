{"ast":null,"code":"import \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/table/style\";\nimport _Table from \"antd/es/table\";\nimport \"antd/es/empty/style\";\nimport _Empty from \"antd/es/empty\";\nimport \"antd/es/popconfirm/style\";\nimport _Popconfirm from \"antd/es/popconfirm\";\nimport \"antd/es/select/style\";\nimport _Select from \"antd/es/select\";\nimport \"antd/es/input/style\";\nimport _Input from \"antd/es/input\";\nimport _objectSpread from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _toConsumableArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/src/materials/tabs/table.js\";\n\nimport React, { useState, useEffect, createContext } from \"react\";\nimport { IconFont } from \"~components\";\nimport { connect } from \"react-redux\";\nimport { useTools } from \"~common/hooks\";\nimport { uuid } from \"~utils\";\nvar Compose = createContext({});\n\nvar EditableRow = function EditableRow(_ref) {\n  var index = _ref.index,\n      props = _objectWithoutProperties(_ref, [\"index\"]);\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      form = _Form$useForm2[0];\n\n  return /*#__PURE__*/React.createElement(Compose.Provider, {\n    value: form,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 14,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(_Form, {\n    form: form,\n    component: false,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"tr\", Object.assign({}, props, {\n    key: index,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 16,\n      columnNumber: 9\n    }\n  }))));\n};\n\nvar EditableCell = function EditableCell(_ref2) {\n  var children = _ref2.children,\n      restProps = _objectWithoutProperties(_ref2, [\"children\"]);\n\n  return /*#__PURE__*/React.createElement(\"td\", Object.assign({}, restProps, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 10\n    }\n  }), children);\n};\n\nvar VTabToTable = function VTabToTable(_ref3) {\n  var name = _ref3.name,\n      cid = _ref3.cid,\n      value = _ref3.value,\n      onChange = _ref3.onChange,\n      dispatch = _ref3.dispatch;\n\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      tableData = _useState2[0],\n      setTableData = _useState2[1];\n\n  var _useTools = useTools(),\n      state = _useTools.state;\n\n  var chartsOptions = state.components.filter(function (v) {\n    return v.type !== \"tabs\";\n  }).map(function (o) {\n    return {\n      uniqueId: o.uniqueId,\n      name: o.name\n    };\n  });\n  useEffect(function () {\n    setTableData(value);\n  }, [state.selected]);\n\n  var changeValue = function changeValue(data) {\n    setTableData(data);\n    onChange(name, data);\n    dispatch({\n      type: \"tab/component\",\n      data: data.map(function (item) {\n        return {\n          id: item.id,\n          form: cid,\n          to: item.mapping.join(\",\")\n        };\n      })\n    });\n  };\n\n  var handleCreate = function handleCreate() {\n    var newData = {\n      id: uuid(),\n      mapping: [],\n      name: \"\"\n    };\n\n    var _newData = [].concat(_toConsumableArray(tableData), [newData]);\n\n    changeValue(_newData);\n  };\n\n  var handleDelete = function handleDelete(key) {\n    var _temp = tableData.filter(function (item) {\n      return item.id !== key;\n    });\n\n    changeValue(_temp);\n  };\n\n  var handleSave = function handleSave(row) {\n    var newData = _toConsumableArray(tableData);\n\n    var index = newData.findIndex(function (item) {\n      return row.id === item.id;\n    });\n    var item = newData[index];\n    newData.splice(index, 1, _objectSpread(_objectSpread({}, item), row));\n    changeValue(newData);\n  };\n\n  var onChangeValue = function onChangeValue(value, row) {\n    var values = _objectSpread(_objectSpread({}, row), value);\n\n    handleSave(values);\n  };\n\n  var columns = [{\n    title: \"tab名称\",\n    dataIndex: \"name\",\n    align: \"center\",\n    width: 150,\n    render: function render(_, record) {\n      return /*#__PURE__*/React.createElement(_Input, {\n        value: record.name,\n        placeholder: \"\\u8BF7\\u8F93\\u5165\",\n        allowClear: true,\n        onChange: function onChange(e) {\n          onChangeValue({\n            name: e.target.value\n          }, record);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91,\n          columnNumber: 9\n        }\n      });\n    }\n  }, {\n    title: \"展示图表\",\n    dataIndex: \"mapping\",\n    align: \"center\",\n    width: 250,\n    render: function render(_, record, index) {\n      return /*#__PURE__*/React.createElement(_Select, {\n        value: record.mapping,\n        mode: \"multiple\",\n        placeholder: \"\\u8BF7\\u9009\\u62E9\\u8981\\u5C55\\u793A\\u7684\\u56FE\\u8868\",\n        style: {\n          width: \"100%\",\n          textAlign: \"left\"\n        },\n        onChange: function onChange(val) {\n          onChangeValue({\n            mapping: val\n          }, record);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 9\n        }\n      }, chartsOptions.map(function (item, index) {\n        return /*#__PURE__*/React.createElement(_Select.Option, {\n          key: index,\n          value: item.uniqueId,\n          __self: _this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 120,\n            columnNumber: 13\n          }\n        }, item.name);\n      }));\n    }\n  }, {\n    title: \"操作\",\n    dataIndex: \"antion\",\n    align: \"center\",\n    width: 100,\n    render: function render(text, record, index) {\n      return tableData.length >= 1 ? /*#__PURE__*/React.createElement(_Popconfirm, {\n        title: \"\\u786E\\u5B9A\\u8981\\u5220\\u9664\\u7B2C\".concat(index + 1, \"\\u884C\\u5B57\\u6BB5\\u6A21\\u578B?\"),\n        onConfirm: function onConfirm() {\n          return handleDelete(record.id);\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(IconFont, {\n        antd: true,\n        type: \"DeleteOutlined\",\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135,\n          columnNumber: 13\n        }\n      })) : null;\n    }\n  }];\n  var renderColumns = columns.map(function (col) {\n    if (!col.editable) {\n      return col;\n    }\n\n    return _objectSpread(_objectSpread({}, col), {}, {\n      onCell: function onCell(record) {\n        return {\n          record: record,\n          editable: col.editable,\n          dataIndex: col.dataIndex,\n          title: col.title\n        };\n      }\n    });\n  });\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(_Table, {\n    scroll: {\n      x: 280\n    },\n    rowKey: \"id\",\n    locale: {\n      emptyText: /*#__PURE__*/React.createElement(_Empty, {\n        image: _Empty.PRESENTED_IMAGE_SIMPLE,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 22\n        }\n      })\n    },\n    tableLayout: \"auto\",\n    components: {\n      body: {\n        row: EditableRow,\n        cell: EditableCell\n      }\n    },\n    columns: renderColumns,\n    dataSource: tableData,\n    pagination: false,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(_Button, {\n    type: \"dashed\",\n    onClick: handleCreate,\n    style: {\n      width: \"100%\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(IconFont, {\n    antd: true,\n    type: \"PlusCircleOutlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default connect(function (state) {\n  return {\n    tabComponent: state.tab.component\n  };\n})(VTabToTable);","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/图元/react-visual-data/src/materials/tabs/table.js"],"names":["React","useState","useEffect","createContext","IconFont","connect","useTools","uuid","Compose","EditableRow","index","props","useForm","form","EditableCell","children","restProps","VTabToTable","name","cid","value","onChange","dispatch","tableData","setTableData","state","chartsOptions","components","filter","v","type","map","o","uniqueId","selected","changeValue","data","item","id","to","mapping","join","handleCreate","newData","_newData","handleDelete","key","_temp","handleSave","row","findIndex","splice","onChangeValue","values","columns","title","dataIndex","align","width","render","_","record","e","target","textAlign","val","text","length","renderColumns","col","editable","onCell","x","emptyText","PRESENTED_IMAGE_SIMPLE","body","cell","tabComponent","tab","component"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, createContext } from \"react\";\nimport { Button, Empty, Form, Table, Input, Popconfirm, Select } from \"antd\";\nimport { IconFont } from \"~components\";\nimport { connect } from \"react-redux\";\nimport { useTools } from \"~common/hooks\";\nimport { uuid } from \"~utils\";\n\nconst Compose = createContext({});\n\nconst EditableRow = ({ index, ...props }) => {\n  const [form] = Form.useForm();\n\n  return (\n    <Compose.Provider value={form}>\n      <Form form={form} component={false}>\n        <tr {...props} key={index} />\n      </Form>\n    </Compose.Provider>\n  );\n};\n\nconst EditableCell = ({ children, ...restProps }) => {\n  return <td {...restProps}>{children}</td>;\n};\n\nconst VTabToTable = ({ name, cid, value, onChange, dispatch }) => {\n  const [tableData, setTableData] = useState([]);\n  const { state } = useTools();\n  const chartsOptions = state.components\n    .filter((v) => v.type !== \"tabs\")\n    .map((o) => ({\n      uniqueId: o.uniqueId,\n      name: o.name\n    }));\n\n  useEffect(() => {\n    setTableData(value);\n  }, [state.selected]);\n\n  const changeValue = (data) => {\n    setTableData(data);\n    onChange(name, data);\n\n    dispatch({\n      type: \"tab/component\",\n      data: data.map((item) => ({\n        id: item.id,\n        form: cid,\n        to: item.mapping.join(\",\")\n      }))\n    });\n  };\n\n  const handleCreate = () => {\n    const newData = { id: uuid(), mapping: [], name: \"\" };\n    let _newData = [...tableData, newData];\n    changeValue(_newData);\n  };\n\n  const handleDelete = (key) => {\n    let _temp = tableData.filter((item) => item.id !== key);\n    changeValue(_temp);\n  };\n\n  const handleSave = (row) => {\n    const newData = [...tableData];\n    const index = newData.findIndex((item) => row.id === item.id);\n    const item = newData[index];\n    newData.splice(index, 1, {\n      ...item,\n      ...row\n    });\n    changeValue(newData);\n  };\n\n  const onChangeValue = (value, row) => {\n    let values = {\n      ...row,\n      ...value\n    };\n    handleSave(values);\n  };\n\n  const columns = [\n    {\n      title: \"tab名称\",\n      dataIndex: \"name\",\n      align: \"center\",\n      width: 150,\n      render: (_, record) => (\n        <Input\n          value={record.name}\n          placeholder=\"请输入\"\n          allowClear\n          onChange={(e) => {\n            onChangeValue({ name: e.target.value }, record);\n          }}\n        />\n      )\n    },\n    {\n      title: \"展示图表\",\n      dataIndex: \"mapping\",\n      align: \"center\",\n      width: 250,\n      render: (_, record, index) => (\n        <Select\n          value={record.mapping}\n          mode=\"multiple\"\n          placeholder=\"请选择要展示的图表\"\n          style={{\n            width: \"100%\",\n            textAlign: \"left\"\n          }}\n          onChange={(val) => {\n            onChangeValue({ mapping: val }, record);\n          }}\n        >\n          {chartsOptions.map((item, index) => (\n            <Select.Option key={index} value={item.uniqueId}>\n              {item.name}\n            </Select.Option>\n          ))}\n        </Select>\n      )\n    },\n    {\n      title: \"操作\",\n      dataIndex: \"antion\",\n      align: \"center\",\n      width: 100,\n      render: (text, record, index) =>\n        tableData.length >= 1 ? (\n          <Popconfirm title={`确定要删除第${index + 1}行字段模型?`} onConfirm={() => handleDelete(record.id)}>\n            <IconFont antd={true} type=\"DeleteOutlined\" />\n          </Popconfirm>\n        ) : null\n    }\n  ];\n\n  const renderColumns = columns.map((col) => {\n    if (!col.editable) {\n      return col;\n    }\n\n    return {\n      ...col,\n      onCell: (record) => ({\n        record,\n        editable: col.editable,\n        dataIndex: col.dataIndex,\n        title: col.title\n      })\n    };\n  });\n\n  return (\n    <>\n      <Table\n        scroll={{\n          x: 280\n        }}\n        rowKey=\"id\"\n        locale={{\n          emptyText: <Empty image={Empty.PRESENTED_IMAGE_SIMPLE} />\n        }}\n        tableLayout=\"auto\"\n        components={{\n          body: {\n            row: EditableRow,\n            cell: EditableCell\n          }\n        }}\n        columns={renderColumns}\n        dataSource={tableData}\n        pagination={false}\n      />\n      <Button type=\"dashed\" onClick={handleCreate} style={{ width: \"100%\" }}>\n        <IconFont antd={true} type=\"PlusCircleOutlined\" />\n      </Button>\n    </>\n  );\n};\n\nexport default connect((state) => ({\n  tabComponent: state.tab.component\n}))(VTabToTable);\n"]},"metadata":{},"sourceType":"module"}