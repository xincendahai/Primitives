{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nimport \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/tooltip/style\";\nimport _Tooltip from \"antd/es/tooltip\";\nimport \"antd/es/typography/style\";\nimport _Typography from \"antd/es/typography\";\nimport \"antd/es/badge/style\";\nimport _Badge from \"antd/es/badge\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/Primitives/src/pages/report/src/header.jsx\";\n\nimport React, { Fragment, useMemo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport copyTOClipboard from \"copy-text-to-clipboard\";\nimport { connect } from \"react-redux\";\nimport { useTools, useStore } from \"~common/hooks\";\nimport { FORM_ID } from \"~common/constants\";\nimport { uuid } from \"~utils\";\nimport { generatorField, getFieldConf, deleteItem } from \"~renderer/utils\";\nimport { IconFont, MonacoEditor } from \"~components\";\nimport storage from \"~utils/storage\";\n\nvar FieldActionsConf = function FieldActionsConf(_ref) {\n  var activeKey = _ref.activeKey,\n      fieldType = _ref.fieldType,\n      conditions = _ref.conditions,\n      dispatch = _ref.dispatch;\n\n  var _useTools = useTools(),\n      state = _useTools.state,\n      setState = _useTools.setState;\n\n  var _useStore = useStore(),\n      view = _useStore.view,\n      setView = _useStore.setView;\n\n  var statusing = useMemo(function () {\n    return activeKey === \"-\";\n  }, [activeKey]); // TODO: 清空\n\n  var handleClear = function handleClear() {\n    setState({\n      components: [],\n      undo: [],\n      redo: []\n    }); // 筛选条件查询关联数据项\n\n    dispatch({\n      type: \"component/activeKey\",\n      data: \"-\"\n    });\n    dispatch({\n      type: \"form/conditions\",\n      data: []\n    });\n    dispatch({\n      type: \"form/dependencies\",\n      data: []\n    });\n    dispatch({\n      type: \"form/parmas\",\n      data: []\n    });\n  }; // TODO: 复制\n\n\n  var handleCopy = function handleCopy() {\n    var curFieldConf = getFieldConf(state.components, activeKey);\n\n    var _generatorField = generatorField(state.components, \"field\", curFieldConf),\n        components = _generatorField.components,\n        fieldId = _generatorField.fieldId;\n\n    setState({\n      components: components\n    });\n    dispatch({\n      type: \"component/activeKey\",\n      data: fieldId\n    }); // 遍历当前组件的id集合便于筛选条件查询关联\n\n    dispatch({\n      type: \"form/dependencies\",\n      data: components.map(function (item) {\n        return item.uniqueId;\n      })\n    });\n  }; // TODO: 删除\n\n\n  var handleDelete = function handleDelete() {\n    var overData;\n    var fieldArr = fieldType === \"form\" ? conditions : state.components; // 识别元件(form/component)\n\n    if (fieldType === \"form\") {\n      overData = deleteItem(activeKey, fieldArr);\n\n      if (overData.data.length > 0) {\n        dispatch({\n          type: \"component/activeKey\",\n          data: overData.uniqueId\n        });\n        dispatch({\n          type: \"form/conditions\",\n          data: overData.data\n        });\n      } else {\n        dispatch({\n          type: \"component/activeKey\",\n          data: \"-\"\n        }); // 表单自定义控件\n\n        dispatch({\n          type: \"form/conditions\",\n          data: []\n        });\n        overData = state.components.filter(function (item) {\n          return item.uniqueId !== FORM_ID;\n        });\n        setState({\n          components: overData\n        });\n      }\n    } else if (activeKey === \"__form__\") {\n      dispatch({\n        type: \"component/activeKey\",\n        data: \"-\"\n      });\n      dispatch({\n        type: \"form/conditions\",\n        data: []\n      });\n      overData = state.components.filter(function (item) {\n        return item.uniqueId !== FORM_ID;\n      });\n      setState({\n        components: overData\n      });\n    } else {\n      overData = deleteItem(activeKey, fieldArr);\n      dispatch({\n        type: \"component/activeKey\",\n        data: overData.uniqueId\n      });\n      setState({\n        components: overData.data\n      });\n    }\n  };\n\n  var toggleModal = function toggleModal() {\n    return setView({\n      visible: !view.visible\n    });\n  };\n\n  var handleCopySchema = function handleCopySchema() {\n    var displaySchemaString = JSON.stringify({\n      page: state.page,\n      components: state.components\n    }, null, 4);\n    copyTOClipboard(displaySchemaString);\n\n    _message.info(\"复制成功\");\n  };\n\n  var handledevlop = function handledevlop() {\n    _message.info(\"待开发...\");\n  };\n\n  return /*#__PURE__*/React.createElement(\"header\", {\n    className: \"gc-design__hd\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-design__hd--title\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(_Typography.Title, {\n    level: 4,\n    className: \"gc-design__hd--h1\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }, \"Axure v2\\xA0\", /*#__PURE__*/React.createElement(_Badge, {\n    status: \"processing\",\n    text: \"Beta\\u6D4B\\u8BD5\\u7248\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-design__hd--icon\",\n    onClick: function onClick() {\n      setView({\n        layerCollapsed: !view.layerCollapsed\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  }, !view.layerCollapsed ? /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u5173\\u95ED\\u4FA7\\u8FB9\\u680F\",\n    key: \"\\u5173\\u95ED\\u4FA7\\u8FB9\\u680F\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IconFont, {\n    antd: true,\n    type: \"LeftSquareOutlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 15\n    }\n  })) : /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u6253\\u5F00\\u4FA7\\u8FB9\\u680F\",\n    key: \"\\u6253\\u5F00\\u4FA7\\u8FB9\\u680F\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IconFont, {\n    antd: true,\n    type: \"RightSquareOutlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 15\n    }\n  })))), /*#__PURE__*/React.createElement(_Space, {\n    className: \"gc-design__hd--action\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    disabled: statusing || fieldType === \"form\" || activeKey === \"__form__\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"CopyOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 17\n      }\n    }),\n    onClick: handleCopy,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 9\n    }\n  }, \"\\u590D\\u5236\"), /*#__PURE__*/React.createElement(_Button, {\n    disabled: statusing,\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"DeleteOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 44\n      }\n    }),\n    onClick: handleDelete,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }\n  }, \"\\u5220\\u9664\"), /*#__PURE__*/React.createElement(_Button, {\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"ClearOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 23\n      }\n    }),\n    onClick: handleClear,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 9\n    }\n  }, \"\\u6E05\\u7A7A\"), /*#__PURE__*/React.createElement(_Button, {\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"UndoOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 137,\n        columnNumber: 23\n      }\n    }),\n    onClick: handledevlop,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 9\n    }\n  }, \"\\u64A4\\u9500\"), /*#__PURE__*/React.createElement(_Button, {\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"RedoOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 23\n      }\n    }),\n    onClick: handledevlop,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }\n  }, \"\\u91CD\\u505A\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-design__hd--setting\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-design__hd--icon\",\n    onClick: function onClick() {\n      setView({\n        settingCollapsed: !view.settingCollapsed\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 9\n    }\n  }, !view.settingCollapsed ? /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u5173\\u95ED\\u914D\\u7F6E\",\n    key: \"\\u5173\\u95ED\\u914D\\u7F6E\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IconFont, {\n    antd: true,\n    type: \"RightSquareOutlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 15\n    }\n  })) : /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u6253\\u5F00\\u914D\\u7F6E\",\n    key: \"\\u5173\\u95ED\\u914D\\u7F6E\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IconFont, {\n    antd: true,\n    type: \"LeftSquareOutlined\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(_Space, {\n    className: \"gc-design__hd--save\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    icon: /*#__PURE__*/React.createElement(Fragment, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/report/preview/\" + uuid(),\n      target: \"_blank\",\n      onClick: function onClick() {\n        storage.setLocal(\"schema_report_config\", {\n          page: state.page,\n          components: state.components\n        });\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"DesktopOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 19\n      }\n    }), \"\\u9884\\u89C8\")),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(_Button, {\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"CloudOutlined\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 25\n      }\n    }),\n    onClick: toggleModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, \"\\u8C03\\u8BD5\"))), /*#__PURE__*/React.createElement(_Modal, {\n    visible: view.visible,\n    title: \"\\u8C03\\u8BD5\",\n    width: 960,\n    okText: \"\\u590D\\u5236\",\n    cancelText: \"\\u53D6\\u6D88\",\n    onOk: handleCopySchema,\n    onCancel: toggleModal,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(MonacoEditor, {\n    height: 600,\n    language: \"json\",\n    value: {\n      page: state.page,\n      conditions: conditions,\n      components: state.components\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 9\n    }\n  })));\n};\n\nexport default connect(function (state) {\n  return {\n    activeKey: state.component.activeKey,\n    fieldType: state.component.fieldType,\n    conditions: state.form.conditions\n  };\n})(FieldActionsConf);","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/Primitives/src/pages/report/src/header.jsx"],"names":["React","Fragment","useMemo","Link","copyTOClipboard","connect","useTools","useStore","FORM_ID","uuid","generatorField","getFieldConf","deleteItem","IconFont","MonacoEditor","storage","FieldActionsConf","activeKey","fieldType","conditions","dispatch","state","setState","view","setView","statusing","handleClear","components","undo","redo","type","data","handleCopy","curFieldConf","fieldId","map","item","uniqueId","handleDelete","overData","fieldArr","length","filter","toggleModal","visible","handleCopySchema","displaySchemaString","JSON","stringify","page","info","handledevlop","layerCollapsed","settingCollapsed","setLocal","component","form"],"mappings":"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","sourcesContent":["import React, { Fragment, useMemo } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport { Modal, Space, Button, Typography, Badge, message, Tooltip } from \"antd\";\nimport copyTOClipboard from \"copy-text-to-clipboard\";\nimport { connect } from \"react-redux\";\nimport { useTools, useStore } from \"~common/hooks\";\nimport { FORM_ID } from \"~common/constants\";\nimport { uuid } from \"~utils\";\nimport { generatorField, getFieldConf, deleteItem } from \"~renderer/utils\";\nimport { IconFont, MonacoEditor } from \"~components\";\nimport storage from \"~utils/storage\";\n\nconst FieldActionsConf = ({ activeKey, fieldType, conditions, dispatch }) => {\n  const { state, setState } = useTools();\n  const { view, setView } = useStore();\n\n  const statusing = useMemo(() => {\n    return activeKey === \"-\";\n  }, [activeKey]);\n\n  // TODO: 清空\n  const handleClear = () => {\n    setState({\n      components: [],\n      undo: [],\n      redo: []\n    });\n\n    // 筛选条件查询关联数据项\n    dispatch({ type: \"component/activeKey\", data: \"-\" });\n    dispatch({ type: \"form/conditions\", data: [] });\n    dispatch({ type: \"form/dependencies\", data: [] });\n    dispatch({ type: \"form/parmas\", data: [] });\n  };\n\n  // TODO: 复制\n  const handleCopy = () => {\n    const curFieldConf = getFieldConf(state.components, activeKey);\n    const { components, fieldId } = generatorField(state.components, \"field\", curFieldConf);\n    setState({ components: components });\n\n    dispatch({ type: \"component/activeKey\", data: fieldId });\n    // 遍历当前组件的id集合便于筛选条件查询关联\n    dispatch({ type: \"form/dependencies\", data: components.map((item) => item.uniqueId) });\n  };\n\n  // TODO: 删除\n  const handleDelete = () => {\n    let overData;\n    const fieldArr = fieldType === \"form\" ? conditions : state.components;\n\n    // 识别元件(form/component)\n    if (fieldType === \"form\") {\n      overData = deleteItem(activeKey, fieldArr);\n\n      if (overData.data.length > 0) {\n        dispatch({ type: \"component/activeKey\", data: overData.uniqueId });\n        dispatch({ type: \"form/conditions\", data: overData.data });\n      } else {\n        dispatch({ type: \"component/activeKey\", data: \"-\" });\n        // 表单自定义控件\n        dispatch({ type: \"form/conditions\", data: [] });\n        overData = state.components.filter((item) => item.uniqueId !== FORM_ID);\n        setState({ components: overData });\n      }\n    } else if (activeKey === \"__form__\") {\n      dispatch({ type: \"component/activeKey\", data: \"-\" });\n      dispatch({ type: \"form/conditions\", data: [] });\n      overData = state.components.filter((item) => item.uniqueId !== FORM_ID);\n      setState({ components: overData });\n    } else {\n      overData = deleteItem(activeKey, fieldArr);\n      dispatch({ type: \"component/activeKey\", data: overData.uniqueId });\n      setState({ components: overData.data });\n    }\n  };\n\n  const toggleModal = () => setView({ visible: !view.visible });\n\n  const handleCopySchema = () => {\n    let displaySchemaString = JSON.stringify(\n      {\n        page: state.page,\n        components: state.components\n      },\n      null,\n      4\n    );\n    copyTOClipboard(displaySchemaString);\n    message.info(\"复制成功\");\n  };\n\n  const handledevlop = () => {\n    message.info(\"待开发...\");\n  };\n\n  return (\n    <header className=\"gc-design__hd\">\n      <div className=\"gc-design__hd--title\">\n        <Typography.Title level={4} className=\"gc-design__hd--h1\">\n          Axure v2&nbsp;\n          <Badge status=\"processing\" text=\"Beta测试版\" />\n        </Typography.Title>\n        <div\n          className=\"gc-design__hd--icon\"\n          onClick={() => {\n            setView({\n              layerCollapsed: !view.layerCollapsed\n            });\n          }}\n        >\n          {!view.layerCollapsed ? (\n            <Tooltip title=\"关闭侧边栏\" key=\"关闭侧边栏\">\n              <IconFont antd={true} type=\"LeftSquareOutlined\" />\n            </Tooltip>\n          ) : (\n            <Tooltip title=\"打开侧边栏\" key=\"打开侧边栏\">\n              <IconFont antd={true} type=\"RightSquareOutlined\" />\n            </Tooltip>\n          )}\n        </div>\n      </div>\n      <Space className=\"gc-design__hd--action\">\n        <Button\n          disabled={statusing || fieldType === \"form\" || activeKey === \"__form__\"}\n          icon={<IconFont antd={true} type=\"CopyOutlined\" />}\n          onClick={handleCopy}\n        >\n          复制\n        </Button>\n        <Button disabled={statusing} icon={<IconFont antd={true} type=\"DeleteOutlined\" />} onClick={handleDelete}>\n          删除\n        </Button>\n        <Button icon={<IconFont antd={true} type=\"ClearOutlined\" />} onClick={handleClear}>\n          清空\n        </Button>\n        <Button icon={<IconFont antd={true} type=\"UndoOutlined\" />} onClick={handledevlop}>\n          撤销\n        </Button>\n        <Button icon={<IconFont antd={true} type=\"RedoOutlined\" />} onClick={handledevlop}>\n          重做\n        </Button>\n      </Space>\n      <div className=\"gc-design__hd--setting\">\n        <div\n          className=\"gc-design__hd--icon\"\n          onClick={() => {\n            setView({\n              settingCollapsed: !view.settingCollapsed\n            });\n          }}\n        >\n          {!view.settingCollapsed ? (\n            <Tooltip title=\"关闭配置\" key=\"关闭配置\">\n              <IconFont antd={true} type=\"RightSquareOutlined\" />\n            </Tooltip>\n          ) : (\n            <Tooltip title=\"打开配置\" key=\"关闭配置\">\n              <IconFont antd={true} type=\"LeftSquareOutlined\" />\n            </Tooltip>\n          )}\n        </div>\n        <Space className=\"gc-design__hd--save\">\n          <Button\n            icon={\n              <Fragment>\n                <Link\n                  to={\"/report/preview/\" + uuid()}\n                  target=\"_blank\"\n                  onClick={() => {\n                    storage.setLocal(\"schema_report_config\", {\n                      page: state.page,\n                      components: state.components\n                    });\n                  }}\n                >\n                  <IconFont antd={true} type=\"DesktopOutlined\" />\n                  预览\n                </Link>\n              </Fragment>\n            }\n          ></Button>\n          <Button icon={<IconFont antd={true} type=\"CloudOutlined\" />} onClick={toggleModal}>\n            调试\n          </Button>\n        </Space>\n      </div>\n      {/* 模态框 */}\n      <Modal\n        visible={view.visible}\n        title=\"调试\"\n        width={960}\n        okText=\"复制\"\n        cancelText=\"取消\"\n        onOk={handleCopySchema}\n        onCancel={toggleModal}\n      >\n        <MonacoEditor\n          height={600}\n          language=\"json\"\n          value={{\n            page: state.page,\n            conditions: conditions,\n            components: state.components\n          }}\n        />\n      </Modal>\n    </header>\n  );\n};\n\nexport default connect((state) => ({\n  activeKey: state.component.activeKey,\n  fieldType: state.component.fieldType,\n  conditions: state.form.conditions\n}))(FieldActionsConf);\n"]},"metadata":{},"sourceType":"module"}