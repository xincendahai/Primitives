{"ast":null,"code":"import \"antd/es/space/style\";\nimport _Space from \"antd/es/space\";\nimport \"antd/es/tooltip/style\";\nimport _Tooltip from \"antd/es/tooltip\";\nimport \"antd/es/button/style\";\nimport _Button from \"antd/es/button\";\nimport \"antd/es/message/style\";\nimport _message from \"antd/es/message\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/Primitives/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/xiangmingxin/Wicrecend/Primitives/src/pages/fullscreen/src/wrapper.jsx\";\nimport React, { useEffect, forwardRef, useRef, useMemo, useLayoutEffect } from \"react\";\nimport { useDrop } from \"react-dnd\";\nimport { connect } from \"react-redux\";\nimport { IconFont, Scrollbar, SketchRuler } from \"~components\";\nimport { generatorField } from \"~renderer/utils\";\nimport { useAutoResize } from \"~common/hooks\";\nimport { useStore, useTools } from \"~common/hooks\";\nimport { THICK, DIMENSION } from \"~common/constants\";\nimport { round, deepMergeObj } from \"~utils/helper\";\nimport { DRAGGABLE_COMPONENT } from \"~common/constants\";\n/**\n * 设计器容器大小\n */\n\nfunction Wrapper(props, ref) {\n  var pageSize = props.pageSize,\n      customPageSize = props.customPageSize,\n      backgroundMode = props.backgroundMode,\n      backgroundColor = props.backgroundColor,\n      backgroundImage = props.backgroundImage,\n      backgroundDefine = props.backgroundDefine,\n      backgroundBlur = props.backgroundBlur,\n      backgroundOpacity = props.backgroundOpacity;\n\n  var _useTools = useTools(),\n      state = _useTools.state,\n      setState = _useTools.setState;\n\n  var _useStore = useStore(),\n      view = _useStore.view,\n      setView = _useStore.setView;\n\n  var _useAutoResize = useAutoResize(ref),\n      width = _useAutoResize.width,\n      height = _useAutoResize.height,\n      domRef = _useAutoResize.domRef;\n\n  var containerRef = useRef(null);\n  var rulerWidth = view.rulerWidth,\n      rulerHeight = view.rulerHeight,\n      scale = view.scale,\n      startX = view.startX,\n      startY = view.startY,\n      lines = view.lines,\n      isShowReferLine = view.isShowReferLine;\n  useEffect(function () {\n    setView({\n      rulerWidth: width ? width : 0,\n      rulerHeight: height,\n      scale: scaleSize\n    });\n    return function () {\n      setView({\n        isShowReferLine: false,\n        lines: {\n          h: [],\n          v: []\n        }\n      });\n    };\n  }, [width, height]);\n  useLayoutEffect(function () {\n    if (pageSize === \"custom\") {\n      console.log(customPageSize); // setView({\n      //   width: props.customPageSize.width,\n      //   height: props.customPageSize.height\n      // });\n    } else {\n      setView({\n        width: DIMENSION[pageSize].width,\n        height: DIMENSION[pageSize].height\n      });\n    }\n  }, [pageSize]); // 计算设计器画布缩放比例\n\n  var scaleSize = useMemo(function () {\n    return width ? Math.floor(width / view.width * 100) / 100 : 1;\n  }, [width, view.width]);\n\n  var handleLine = function handleLine(lines) {\n    setView({\n      lines: lines\n    });\n  }; // 显示/隐藏 参考线\n\n\n  var handleShowReferLine = function handleShowReferLine() {\n    setView({\n      isShowReferLine: !isShowReferLine\n    });\n  };\n\n  var containerStyle = {\n    width: view.width * scale + \"px\",\n    height: view.height * scale + \"px\"\n  };\n  var canvasStyle = {\n    width: view.width,\n    height: view.height,\n    transform: \"scale(\".concat(scale, \")\")\n  };\n  var backgroundStyles = useMemo(function () {\n    if (backgroundMode === \"custom\") {\n      return backgroundImage ? \"url(\".concat(backgroundImage, \") 0% 0% / 100% 100%\") : backgroundColor;\n    }\n\n    if (backgroundMode === \"define\") {\n      return \"url(./static/templet/\".concat(backgroundDefine, \") 0% 0% / 100% 100%\");\n    }\n\n    return backgroundColor ? backgroundColor : null;\n  }, [backgroundMode, backgroundImage, backgroundDefine, backgroundColor]);\n\n  var handleSetting = function handleSetting() {\n    setView({\n      isShowReferLine: false,\n      lines: {\n        h: [],\n        v: []\n      }\n    });\n  };\n\n  var onNodeChange = function onNodeChange(item) {\n    try {\n      var _generatorField = generatorField(state.components, \"field\", item),\n          components = _generatorField.components,\n          fieldId = _generatorField.fieldId;\n\n      setState({\n        tabsKey: \"base\",\n        components: components\n      });\n      props.dispatch({\n        type: \"component/activeKey\",\n        data: fieldId\n      });\n    } catch (error) {\n      console.log(\"\\u7EC4\\u4EF6\\u521B\\u5EFA\\u5931\\u8D25\\uFF0C\".concat(error));\n    }\n  }; // 处理组件拖拽落下事件\n\n\n  var _useDrop = useDrop({\n    accept: [DRAGGABLE_COMPONENT],\n    collect: function collect(monitor) {\n      return {\n        isOver: monitor.isOver()\n      };\n    },\n    drop: function drop(item, monitor) {\n      if (monitor.canDrop()) {\n        // 拖动操作正在进行时，返回指针的最后记录的{x，y}client 偏移量。 如果没有拖动项目，则返回 null\n        var currentMouseOffset = monitor.getClientOffset(); // 返回当前拖动操作开始时指针的{x，y} client 偏移量。 如果没有拖动项目，则返回 null\n\n        var sourceMouseOffset = monitor.getInitialClientOffset(); // 返回当前拖动操作开始时 drag source 组件的根DOM节点的{x，y}client 偏移量。 如果没有拖动项目，则返回 null\n\n        var sourceElementOffset = monitor.getInitialSourceClientOffset();\n\n        var _containerRef$current = containerRef.current.getValues(),\n            top = _containerRef$current.top,\n            left = _containerRef$current.left;\n\n        var diffX = sourceMouseOffset.x - sourceElementOffset.x;\n        var diffY = sourceMouseOffset.y - sourceElementOffset.y;\n        var x = currentMouseOffset.x - diffX + left;\n        var y = currentMouseOffset.y - diffY + top;\n        console.log(\"currentMouseOffset\", currentMouseOffset); // 组件完成新建工作\n\n        var options = deepMergeObj(item.component, {\n          data: {\n            left: x,\n            top: y\n          }\n        });\n        onNodeChange(options);\n      } else {\n        _message.info(\"实验数据建立中，请稍后再尝试添加节点\");\n      }\n    }\n  }),\n      _useDrop2 = _slicedToArray(_useDrop, 2),\n      dropRef = _useDrop2[1];\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"gc-design__wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(SketchRuler, {\n    THICK: THICK,\n    scale: scale,\n    width: rulerWidth,\n    height: rulerHeight,\n    startX: startX,\n    startY: startY,\n    horLineArr: lines.h,\n    verLineArr: lines.v,\n    isOpenMenuFeature: true,\n    isShowReferLine: isShowReferLine,\n    handleLine: handleLine,\n    handleShowReferLine: handleShowReferLine,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ruler-wrapper\",\n    ref: domRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Scrollbar, {\n    ref: function ref(el) {\n      containerRef.current = el;\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"canvas-container design-pannable\",\n    style: containerStyle,\n    tabIndex: \"-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"design-body\",\n    ref: dropRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"design-container\",\n    style: canvasStyle,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bg-container\",\n    style: {\n      background: backgroundStyles,\n      filter: \"blur(\".concat(backgroundBlur, \"px)\"),\n      opacity: parseFloat(backgroundOpacity / 10)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 17\n    }\n  }), props.children))))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ruler-tool\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u6E05\\u7A7A\\u6240\\u6709\\u53C2\\u8003\\u7EBF\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    shape: \"circle\",\n    size: \"small\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"SettingOutlined\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 19\n      }\n    }),\n    onClick: handleSetting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 11\n    }\n  })), /*#__PURE__*/React.createElement(_Space, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u6EDA\\u52A8\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    shape: \"circle\",\n    size: \"small\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"ColumnHeightOutlined\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 21\n      }\n    }),\n    onClick: function onClick() {\n      containerRef.current.scrollTo(1000, 1000);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u7F29\\u5C0F\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    shape: \"circle\",\n    size: \"small\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"ZoomOutOutlined\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 21\n      }\n    }),\n    onClick: function onClick() {\n      setView({\n        scale: round(Math.max(0.2, scale - 0.1), 2)\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u653E\\u5927\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    shape: \"circle\",\n    size: \"small\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"ZoomInOutlined\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 21\n      }\n    }),\n    onClick: function onClick() {\n      setView({\n        scale: round(Math.min(2, scale + 0.1), 2)\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(_Tooltip, {\n    title: \"\\u81EA\\u9002\\u5E94\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    shape: \"circle\",\n    size: \"small\",\n    icon: /*#__PURE__*/React.createElement(IconFont, {\n      antd: true,\n      type: \"ExpandOutlined\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 21\n      }\n    }),\n    onClick: function onClick() {\n      setView({\n        scale: round(scaleSize, 2)\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  })))));\n}\n\nexport default connect(function (state) {\n  return {\n    activeKey: state.component.activeKey\n  };\n})(forwardRef(Wrapper));","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/Primitives/src/pages/fullscreen/src/wrapper.jsx"],"names":["React","useEffect","forwardRef","useRef","useMemo","useLayoutEffect","useDrop","connect","IconFont","Scrollbar","SketchRuler","generatorField","useAutoResize","useStore","useTools","THICK","DIMENSION","round","deepMergeObj","DRAGGABLE_COMPONENT","Wrapper","props","ref","pageSize","customPageSize","backgroundMode","backgroundColor","backgroundImage","backgroundDefine","backgroundBlur","backgroundOpacity","state","setState","view","setView","width","height","domRef","containerRef","rulerWidth","rulerHeight","scale","startX","startY","lines","isShowReferLine","scaleSize","h","v","console","log","Math","floor","handleLine","handleShowReferLine","containerStyle","canvasStyle","transform","backgroundStyles","handleSetting","onNodeChange","item","components","fieldId","tabsKey","dispatch","type","data","error","accept","collect","monitor","isOver","drop","canDrop","currentMouseOffset","getClientOffset","sourceMouseOffset","getInitialClientOffset","sourceElementOffset","getInitialSourceClientOffset","current","getValues","top","left","diffX","x","diffY","y","options","component","info","dropRef","el","background","filter","opacity","parseFloat","children","scrollTo","max","min","activeKey"],"mappings":"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","sourcesContent":["import React, { useEffect, forwardRef, useRef, useMemo, useLayoutEffect } from \"react\";\nimport { Space, Button, Tooltip, message } from \"antd\";\nimport { useDrop } from \"react-dnd\";\nimport { connect } from \"react-redux\";\nimport { IconFont, Scrollbar, SketchRuler } from \"~components\";\nimport { generatorField } from \"~renderer/utils\";\nimport { useAutoResize } from \"~common/hooks\";\nimport { useStore, useTools } from \"~common/hooks\";\nimport { THICK, DIMENSION } from \"~common/constants\";\nimport { round, deepMergeObj } from \"~utils/helper\";\nimport { DRAGGABLE_COMPONENT } from \"~common/constants\";\n\n/**\n * 设计器容器大小\n */\nfunction Wrapper(props, ref) {\n  let {\n    pageSize,\n    customPageSize,\n    backgroundMode,\n    backgroundColor,\n    backgroundImage,\n    backgroundDefine,\n    backgroundBlur,\n    backgroundOpacity\n  } = props;\n  const { state, setState } = useTools();\n  const { view, setView } = useStore();\n  const { width, height, domRef } = useAutoResize(ref);\n  const containerRef = useRef(null);\n\n  const { rulerWidth, rulerHeight, scale, startX, startY, lines, isShowReferLine } = view;\n\n  useEffect(() => {\n    setView({\n      rulerWidth: width ? width : 0,\n      rulerHeight: height,\n      scale: scaleSize\n    });\n\n    return () => {\n      setView({\n        isShowReferLine: false,\n        lines: {\n          h: [],\n          v: []\n        }\n      });\n    };\n  }, [width, height]);\n\n  useLayoutEffect(() => {\n    if (pageSize === \"custom\") {\n      console.log(customPageSize);\n      // setView({\n      //   width: props.customPageSize.width,\n      //   height: props.customPageSize.height\n      // });\n    } else {\n      setView({\n        width: DIMENSION[pageSize].width,\n        height: DIMENSION[pageSize].height\n      });\n    }\n  }, [pageSize]);\n\n  // 计算设计器画布缩放比例\n  const scaleSize = useMemo(() => {\n    return width ? Math.floor((width / view.width) * 100) / 100 : 1;\n  }, [width, view.width]);\n\n  const handleLine = (lines) => {\n    setView({ lines });\n  };\n  // 显示/隐藏 参考线\n  const handleShowReferLine = () => {\n    setView({ isShowReferLine: !isShowReferLine });\n  };\n\n  const containerStyle = {\n    width: view.width * scale + \"px\",\n    height: view.height * scale + \"px\"\n  };\n\n  const canvasStyle = {\n    width: view.width,\n    height: view.height,\n    transform: `scale(${scale})`\n  };\n\n  const backgroundStyles = useMemo(() => {\n    if (backgroundMode === \"custom\") {\n      return backgroundImage ? `url(${backgroundImage}) 0% 0% / 100% 100%` : backgroundColor;\n    }\n\n    if (backgroundMode === \"define\") {\n      return `url(./static/templet/${backgroundDefine}) 0% 0% / 100% 100%`;\n    }\n\n    return backgroundColor ? backgroundColor : null;\n  }, [backgroundMode, backgroundImage, backgroundDefine, backgroundColor]);\n\n  const handleSetting = () => {\n    setView({\n      isShowReferLine: false,\n      lines: {\n        h: [],\n        v: []\n      }\n    });\n  };\n\n  const onNodeChange = (item) => {\n    try {\n      const { components, fieldId } = generatorField(state.components, \"field\", item);\n      setState({ tabsKey: \"base\", components: components });\n      props.dispatch({ type: \"component/activeKey\", data: fieldId });\n    } catch (error) {\n      console.log(`组件创建失败，${error}`);\n    }\n  };\n\n  // 处理组件拖拽落下事件\n  const [, dropRef] = useDrop({\n    accept: [DRAGGABLE_COMPONENT],\n    collect: (monitor) => ({\n      isOver: monitor.isOver()\n    }),\n    drop: (item, monitor) => {\n      if (monitor.canDrop()) {\n        // 拖动操作正在进行时，返回指针的最后记录的{x，y}client 偏移量。 如果没有拖动项目，则返回 null\n        const currentMouseOffset = monitor.getClientOffset();\n        // 返回当前拖动操作开始时指针的{x，y} client 偏移量。 如果没有拖动项目，则返回 null\n        const sourceMouseOffset = monitor.getInitialClientOffset();\n        // 返回当前拖动操作开始时 drag source 组件的根DOM节点的{x，y}client 偏移量。 如果没有拖动项目，则返回 null\n        const sourceElementOffset = monitor.getInitialSourceClientOffset();\n        const { top, left } = containerRef.current.getValues();\n        const diffX = sourceMouseOffset.x - sourceElementOffset.x;\n        const diffY = sourceMouseOffset.y - sourceElementOffset.y;\n        const x = currentMouseOffset.x - diffX + left;\n        const y = currentMouseOffset.y - diffY + top;\n\n        console.log(\"currentMouseOffset\", currentMouseOffset);\n\n        // 组件完成新建工作\n        const options = deepMergeObj(item.component, { data: { left: x, top: y } });\n        onNodeChange(options);\n      } else {\n        message.info(\"实验数据建立中，请稍后再尝试添加节点\");\n      }\n    }\n  });\n\n  return (\n    <div className=\"gc-design__wrapper\">\n      {/* 刻度尺 */}\n      <SketchRuler\n        THICK={THICK}\n        scale={scale}\n        width={rulerWidth}\n        height={rulerHeight}\n        startX={startX}\n        startY={startY}\n        horLineArr={lines.h}\n        verLineArr={lines.v}\n        isOpenMenuFeature={true}\n        isShowReferLine={isShowReferLine}\n        handleLine={handleLine}\n        handleShowReferLine={handleShowReferLine}\n      />\n      <div className=\"ruler-wrapper\" ref={domRef}>\n        <Scrollbar\n          ref={(el) => {\n            containerRef.current = el;\n          }}\n        >\n          <div className=\"canvas-container design-pannable\" style={containerStyle} tabIndex=\"-1\">\n            <div className=\"design-body\" ref={dropRef}>\n              <div className=\"design-container\" style={canvasStyle}>\n                <div\n                  className=\"bg-container\"\n                  style={{\n                    background: backgroundStyles,\n                    filter: `blur(${backgroundBlur}px)`,\n                    opacity: parseFloat(backgroundOpacity / 10)\n                  }}\n                />\n                {props.children}\n              </div>\n            </div>\n          </div>\n        </Scrollbar>\n      </div>\n      <div className=\"ruler-tool\">\n        <Tooltip title=\"清空所有参考线\">\n          <Button\n            shape=\"circle\"\n            size=\"small\"\n            icon={<IconFont antd={true} type=\"SettingOutlined\" />}\n            onClick={handleSetting}\n          />\n        </Tooltip>\n        <Space>\n          <Tooltip title=\"滚动\">\n            <Button\n              shape=\"circle\"\n              size=\"small\"\n              icon={<IconFont antd={true} type=\"ColumnHeightOutlined\" />}\n              onClick={() => {\n                containerRef.current.scrollTo(1000, 1000);\n              }}\n            />\n          </Tooltip>\n          <Tooltip title=\"缩小\">\n            <Button\n              shape=\"circle\"\n              size=\"small\"\n              icon={<IconFont antd={true} type=\"ZoomOutOutlined\" />}\n              onClick={() => {\n                setView({ scale: round(Math.max(0.2, scale - 0.1), 2) });\n              }}\n            />\n          </Tooltip>\n          <Tooltip title=\"放大\">\n            <Button\n              shape=\"circle\"\n              size=\"small\"\n              icon={<IconFont antd={true} type=\"ZoomInOutlined\" />}\n              onClick={() => {\n                setView({ scale: round(Math.min(2, scale + 0.1), 2) });\n              }}\n            />\n          </Tooltip>\n          <Tooltip title=\"自适应\">\n            <Button\n              shape=\"circle\"\n              size=\"small\"\n              icon={<IconFont antd={true} type=\"ExpandOutlined\" />}\n              onClick={() => {\n                setView({ scale: round(scaleSize, 2) });\n              }}\n            />\n          </Tooltip>\n        </Space>\n      </div>\n    </div>\n  );\n}\n\nexport default connect((state) => ({\n  activeKey: state.component.activeKey\n}))(forwardRef(Wrapper));\n"]},"metadata":{},"sourceType":"module"}