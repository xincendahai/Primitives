{"ast":null,"code":"import _slicedToArray from \"/Users/xiangmingxin/Wicrecend/Primitives/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/Primitives/src/materials/vcharts/src/pie.js\";\n\nimport React, { useState, useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Vcharts } from \"~components\";\nimport SubDialog from \"../../dialog\";\nimport getOption from \"../options/pie\";\nimport { isEmpty } from \"~utils/helper\";\n\nvar GeneratorPie = function GeneratorPie(_ref) {\n  var value = _ref.value,\n      options = _ref.options,\n      onChange = _ref.onChange,\n      mode = _ref.mode,\n      drilldowns = _ref.drilldowns,\n      dispatch = _ref.dispatch;\n  if (isEmpty(value.dataConfig.data)) return null;\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      dataSource = _useState2[0],\n      setDataSource = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      stauts = _useState4[0],\n      setStauts = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      visible = _useState6[0],\n      setVisible = _useState6[1];\n\n  var dataConfig = value.dataConfig,\n      isRefresh = value.isRefresh,\n      drillDownOpen = value.drillDownOpen;\n  useEffect(function () {\n    setDataSource(dataConfig.data);\n  }, [dataConfig.data.series]);\n  useEffect(function () {\n    setStauts(drillDownOpen);\n  }, [drillDownOpen]);\n  var currentOption = getOption(options, dataConfig.data);\n  var subDialogTpl = useMemo(function () {\n    return visible && value.drillDown && value.drillDown.length > 0 ? /*#__PURE__*/React.createElement(SubDialog, {\n      visible: visible,\n      value: value.drillDown[0],\n      onRowValueChange: onChange,\n      onCancel: function onCancel(e) {\n        e.stopPropagation(); // TODO: 解锁图层\n\n        mode === \"development\" && value.drillDown[0].drillDownLevel === 0 && onChange({\n          isLock: false\n        }, 0); // TODO: 下钻过滤参数条件\n\n        drilldowns.pop();\n        dispatch({\n          type: \"component/drilldown\",\n          data: drilldowns\n        });\n        setVisible(function (o) {\n          return !o;\n        });\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 27,\n        columnNumber: 7\n      }\n    }) : null;\n  }, [visible, onChange]);\n\n  if (drillDownOpen) {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, subDialogTpl, /*#__PURE__*/React.createElement(Vcharts, {\n      refresh: stauts,\n      options: currentOption.options,\n      onChartReady: function onChartReady(echart) {\n        currentOption.callback && currentOption.callback(echart);\n      },\n      theme: \"dark\",\n      onEvents: {\n        click: function click(param) {\n          if (value.drillDown.length === 0) return; // TODO: 锁住图层\n\n          mode === \"development\" && onChange({\n            isLock: true\n          }, 0);\n          dispatch({\n            type: \"component/drilldown\",\n            data: drilldowns.concat([{\n              fireKey: \"\",\n              item: {\n                name: param.name,\n                value: param.value,\n                category: param.seriesName,\n                _default: param.name\n              }\n            }])\n          });\n          setVisible(true);\n        }\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  return /*#__PURE__*/React.createElement(Vcharts, {\n    refresh: isRefresh,\n    options: currentOption.options,\n    onChartReady: function onChartReady(echart) {\n      currentOption.callback && currentOption.callback(echart);\n    },\n    theme: \"dark\",\n    style: {\n      width: \"100%\",\n      height: \"100%\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 5\n    }\n  });\n};\n\nexport default connect(function (state) {\n  return {\n    mode: state.component.mode,\n    drilldowns: state.component.drilldown,\n    dependencies: state.component.dependencies\n  };\n})(GeneratorPie);","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/Primitives/src/materials/vcharts/src/pie.js"],"names":["React","useState","useEffect","useMemo","connect","Vcharts","SubDialog","getOption","isEmpty","GeneratorPie","value","options","onChange","mode","drilldowns","dispatch","dataConfig","data","dataSource","setDataSource","stauts","setStauts","visible","setVisible","isRefresh","drillDownOpen","series","currentOption","subDialogTpl","drillDown","length","e","stopPropagation","drillDownLevel","isLock","pop","type","o","echart","callback","click","param","concat","fireKey","item","name","category","seriesName","_default","width","height","state","component","drilldown","dependencies"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useMemo } from \"react\";\nimport { connect } from \"react-redux\";\nimport { Vcharts } from \"~components\";\nimport SubDialog from \"../../dialog\";\nimport getOption from \"../options/pie\";\nimport { isEmpty } from \"~utils/helper\";\n\nconst GeneratorPie = ({ value, options, onChange, mode, drilldowns, dispatch }) => {\n  if (isEmpty(value.dataConfig.data)) return null;\n  const [dataSource, setDataSource] = useState({});\n  const [stauts, setStauts] = useState(false);\n  const [visible, setVisible] = useState(false);\n  const { dataConfig, isRefresh, drillDownOpen } = value;\n\n  useEffect(() => {\n    setDataSource(dataConfig.data);\n  }, [dataConfig.data.series]);\n\n  useEffect(() => {\n    setStauts(drillDownOpen);\n  }, [drillDownOpen]);\n\n  let currentOption = getOption(options, dataConfig.data);\n\n  const subDialogTpl = useMemo(() => {\n    return visible && value.drillDown && value.drillDown.length > 0 ? (\n      <SubDialog\n        visible={visible}\n        value={value.drillDown[0]}\n        onRowValueChange={onChange}\n        onCancel={(e) => {\n          e.stopPropagation();\n          // TODO: 解锁图层\n          mode === \"development\" && value.drillDown[0].drillDownLevel === 0 && onChange({ isLock: false }, 0);\n          // TODO: 下钻过滤参数条件\n          drilldowns.pop();\n          dispatch({ type: \"component/drilldown\", data: drilldowns });\n          setVisible((o) => !o);\n        }}\n      />\n    ) : null;\n  }, [visible, onChange]);\n\n  if (drillDownOpen) {\n    return (\n      <>\n        {subDialogTpl}\n        <Vcharts\n          refresh={stauts}\n          options={currentOption.options}\n          onChartReady={(echart) => {\n            currentOption.callback && currentOption.callback(echart);\n          }}\n          theme=\"dark\"\n          onEvents={{\n            click: (param) => {\n              if (value.drillDown.length === 0) return;\n              // TODO: 锁住图层\n              mode === \"development\" && onChange({ isLock: true }, 0);\n              dispatch({\n                type: \"component/drilldown\",\n                data: drilldowns.concat([\n                  {\n                    fireKey: \"\",\n                    item: {\n                      name: param.name,\n                      value: param.value,\n                      category: param.seriesName,\n                      _default: param.name\n                    }\n                  }\n                ])\n              });\n\n              setVisible(true);\n            }\n          }}\n        />\n      </>\n    );\n  }\n\n  return (\n    <Vcharts\n      refresh={isRefresh}\n      options={currentOption.options}\n      onChartReady={(echart) => {\n        currentOption.callback && currentOption.callback(echart);\n      }}\n      theme=\"dark\"\n      style={{ width: \"100%\", height: \"100%\" }}\n    />\n  );\n};\n\nexport default connect((state) => ({\n  mode: state.component.mode,\n  drilldowns: state.component.drilldown,\n  dependencies: state.component.dependencies\n}))(GeneratorPie);\n"]},"metadata":{},"sourceType":"module"}