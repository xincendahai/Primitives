{"ast":null,"code":"import _defineProperty from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/xiangmingxin/Wicrecend/\\u56FE\\u5143/react-visual-data/src/library/renderer/core/screen.jsx\";\n\n/**\n * 基于rnd的核心拖拽方案\n */\nimport React, { useMemo, useState, useEffect, useCallback } from \"react\";\nimport cx from \"classnames\";\nimport { Rnd } from \"react-rnd\";\nimport { connect } from \"react-redux\";\nimport { getField } from \"~materials\";\nimport { useStore, useTools } from \"~common/hooks\";\nimport { throttle } from \"~utils\";\nimport { round, converLayout } from \"~utils/helper\";\nimport generator from \"../generator\"; // TODO：ui和组件拔插模式\n\nvar ScreenRenderer = function ScreenRenderer(_ref) {\n  var _cx;\n\n  var value = _ref.value,\n      onValueChange = _ref.onValueChange,\n      tabDependencies = _ref.tabDependencies,\n      tabComponent = _ref.tabComponent,\n      activeKey = _ref.activeKey,\n      dispatch = _ref.dispatch;\n\n  var _value$data = value.data,\n      width = _value$data.width,\n      height = _value$data.height,\n      background = _value$data.background,\n      left = _value$data.left,\n      top = _value$data.top,\n      isHidden = _value$data.isHidden,\n      isLock = _value$data.isLock,\n      rest = _objectWithoutProperties(_value$data, [\"width\", \"height\", \"background\", \"left\", \"top\", \"isHidden\", \"isLock\"]);\n\n  var _useState = useState({\n    left: left,\n    top: top\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      locations = _useState2[0],\n      setLocations = _useState2[1];\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      show = _useState4[0],\n      setShow = _useState4[1];\n\n  var _useTools = useTools(),\n      state = _useTools.state,\n      setState = _useTools.setState;\n\n  var _useStore = useStore(),\n      view = _useStore.view;\n\n  var classNames = cx(\"gc-field animate__animated\", (_cx = {}, _defineProperty(_cx, \"animate__\".concat(rest.animateType), rest.animateType), _defineProperty(_cx, \"animate__\".concat(rest.animateSpeed), rest.animateSpeed), _defineProperty(_cx, \"animate__\".concat(rest.animateRepeat), rest.animateRepeat), _defineProperty(_cx, \"animate__delay-\".concat(rest.animateTime, \"s\"), rest.animateTime), _cx));\n  var isSelect = useMemo(function () {\n    return activeKey === value.uniqueId;\n  }, [activeKey]);\n  var isEditing = useMemo(function () {\n    return isLock || isHidden;\n  }, [isLock, isHidden]); // TODO: tabs控件控制器\n\n  useEffect(function () {\n    if (tabComponent.length === 0) return;\n\n    var _tabComponents = state.components.filter(function (item) {\n      return tabComponent.some(function (el) {\n        return el.to.includes(item.uniqueId);\n      });\n    });\n\n    var _components = _tabComponents.find(function (item) {\n      return item.uniqueId === value.uniqueId;\n    });\n\n    if (typeof _components === \"undefined\") {\n      return;\n    }\n\n    if (_components && tabDependencies.length && value.type !== \"tabs\") {\n      var ret = tabDependencies.some(function (el) {\n        return el.mapping.includes(value.uniqueId);\n      });\n      setShow(ret);\n    }\n  }, [tabDependencies]);\n  useEffect(function () {\n    setShow(!isHidden);\n  }, [isHidden]);\n\n  var handleClick = function handleClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (isSelect) return;\n    setState({\n      tabsKey: \"base\"\n    }); // TODO: 获取当前用户点击的key\n\n    dispatch({\n      type: \"component/activeKey\",\n      data: value.uniqueId\n    });\n  }; // const handleMouseOver = useCallback(\n  //   (e) => {\n  //     e.preventDefault();\n  //     e.stopPropagation();\n  //     if (activeKey === value.uniqueId) return;\n  //     // TODO: 获取当前用户点击的key\n  //     throttle(dispatch({ type: \"component/activeKey\", data: value.uniqueId }), 800);\n  //   },\n  //   [activeKey]\n  // );\n  // const handleMouseOut = useCallback(\n  //   (e) => {\n  //     e.preventDefault();\n  //     e.stopPropagation();\n  //     if (activeKey === value.uniqueId) return;\n  //     // TODO: 获取当前用户点击的key\n  //     throttle(dispatch({ type: \"component/activeKey\", data: \"-\" }), 800);\n  //   },\n  //   [activeKey]\n  // );\n\n\n  var overwriteStyle = {\n    width: converLayout(width),\n    height: converLayout(height),\n    borderStyle: rest.borderStyle || \"solid\",\n    borderColor: isSelect ? \"#2681ff\" : \"transparent\",\n    background: background,\n    borderRadius: rest.borderRadius,\n    borderWidth: rest.borderWidth || 2,\n    boxShadow: rest.shadowColor ? \"\".concat(rest.shadowColor, \" \").concat(rest.shadowWidth || 0, \" \").concat(rest.shadowOffset || 0, \" \").concat(rest.shadowOffset || 0) : rest.shadowWidth\n  };\n  var getSubField = useCallback(function (m) {\n    var prop = getField(value.type);\n    return generator(prop)(m);\n  }, [value.type]);\n\n  var onDragHandle = function onDragHandle(e, d) {\n    e.preventDefault();\n    e.stopPropagation(); // TODO： 调优节流\n\n    throttle(setLocations({\n      left: round(d.lastX),\n      top: round(d.lastY)\n    }));\n  };\n\n  var onDragStopHandle = function onDragStopHandle(e, d) {\n    e.preventDefault();\n    e.stopPropagation();\n    onValueChange(value.uniqueId, Object.assign(value.data, {\n      left: round(d.lastX),\n      top: round(d.lastY)\n    }));\n  };\n\n  var onResizeHandle = function onResizeHandle(e, direction, ref, delta, position) {\n    e.preventDefault();\n    e.stopPropagation(); // TODO： 调优节流\n\n    throttle(onValueChange(value.uniqueId, Object.assign(value.data, {\n      left: round(position.x),\n      top: round(position.y),\n      width: ref.offsetWidth,\n      height: ref.offsetHeight\n    })));\n  }; // 阻止事件默认事件、冒泡\n\n\n  var onStopPropagation = function onStopPropagation(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    return;\n  };\n\n  var fieldProps = useMemo(function () {\n    return {\n      value: value.data,\n      uniqueId: value.uniqueId,\n      type: value.type,\n      options: value.data.config || {},\n      onChange: function onChange(val) {\n        var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n        onValueChange && onValueChange(value.uniqueId, val, level);\n      }\n    };\n  }, [isSelect, onValueChange]);\n  return /*#__PURE__*/React.createElement(Rnd, {\n    size: {\n      width: width,\n      height: height\n    },\n    position: {\n      x: left,\n      y: top\n    },\n    id: value.uniqueId,\n    bounds: \"body\",\n    dragAxis: \"both\",\n    disableDragging: isEditing,\n    enableResizing: !isEditing,\n    scale: view.scale,\n    onDragStart: onStopPropagation,\n    onDrag: onDragHandle,\n    onDragStop: onDragStopHandle,\n    onResize: onResizeHandle,\n    onResizeStop: onStopPropagation,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: cx(\"grid-line\", {\n      \"is-active\": isSelect\n    }),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"grid-line-top\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"grid-line-left\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"grid-line-label\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 9\n    }\n  }, locations.left, \", \", locations.top)), /*#__PURE__*/React.createElement(\"div\", {\n    className: classNames,\n    style: overwriteStyle,\n    onClick: handleClick // onMouseEnter={(e) => {\n    //   handleMouseOver(e);\n    // }}\n    // onMouseLeave={(e) => {\n    //   handleMouseOut(e);\n    // }}\n    ,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }, show ? getSubField(fieldProps) : null, isSelect ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"widget-circle\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"widget-circle__top\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-left\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"widget-circle__bottom\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bottom-left\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bottom-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"bottom-right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"widget-circle__left\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"left-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"widget-circle__right\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"right-center\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 15\n    }\n  }))) : null));\n};\n\nexport default connect(function (state) {\n  return {\n    activeKey: state.component.activeKey,\n    tabDependencies: state.tab.dependencies,\n    tabComponent: state.tab.component\n  };\n})(ScreenRenderer);","map":{"version":3,"sources":["/Users/xiangmingxin/Wicrecend/图元/react-visual-data/src/library/renderer/core/screen.jsx"],"names":["React","useMemo","useState","useEffect","useCallback","cx","Rnd","connect","getField","useStore","useTools","throttle","round","converLayout","generator","ScreenRenderer","value","onValueChange","tabDependencies","tabComponent","activeKey","dispatch","data","width","height","background","left","top","isHidden","isLock","rest","locations","setLocations","show","setShow","state","setState","view","classNames","animateType","animateSpeed","animateRepeat","animateTime","isSelect","uniqueId","isEditing","length","_tabComponents","components","filter","item","some","el","to","includes","_components","find","type","ret","mapping","handleClick","e","preventDefault","stopPropagation","tabsKey","overwriteStyle","borderStyle","borderColor","borderRadius","borderWidth","boxShadow","shadowColor","shadowWidth","shadowOffset","getSubField","m","prop","onDragHandle","d","lastX","lastY","onDragStopHandle","Object","assign","onResizeHandle","direction","ref","delta","position","x","y","offsetWidth","offsetHeight","onStopPropagation","fieldProps","options","config","onChange","val","level","scale","component","tab","dependencies"],"mappings":"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","sourcesContent":["/**\n * 基于rnd的核心拖拽方案\n */\nimport React, { useMemo, useState, useEffect, useCallback } from \"react\";\nimport cx from \"classnames\";\nimport { Rnd } from \"react-rnd\";\nimport { connect } from \"react-redux\";\nimport { getField } from \"~materials\";\nimport { useStore, useTools } from \"~common/hooks\";\nimport { throttle } from \"~utils\";\nimport { round, converLayout } from \"~utils/helper\";\nimport generator from \"../generator\";\n\n// TODO：ui和组件拔插模式\nconst ScreenRenderer = ({ value, onValueChange, tabDependencies, tabComponent, activeKey, dispatch }) => {\n  const { width, height, background, left, top, isHidden, isLock, ...rest } = value.data;\n  const [locations, setLocations] = useState({ left: left, top: top });\n  const [show, setShow] = useState(true);\n  const { state, setState } = useTools();\n  const { view } = useStore();\n\n  const classNames = cx(\"gc-field animate__animated\", {\n    [`animate__${rest.animateType}`]: rest.animateType,\n    [`animate__${rest.animateSpeed}`]: rest.animateSpeed,\n    [`animate__${rest.animateRepeat}`]: rest.animateRepeat,\n    [`animate__delay-${rest.animateTime}s`]: rest.animateTime\n  });\n\n  const isSelect = useMemo(() => {\n    return activeKey === value.uniqueId;\n  }, [activeKey]);\n\n  const isEditing = useMemo(() => {\n    return isLock || isHidden;\n  }, [isLock, isHidden]);\n\n  // TODO: tabs控件控制器\n  useEffect(() => {\n    if (tabComponent.length === 0) return;\n\n    const _tabComponents = state.components.filter((item) => tabComponent.some((el) => el.to.includes(item.uniqueId)));\n    let _components = _tabComponents.find((item) => item.uniqueId === value.uniqueId);\n    if (typeof _components === \"undefined\") {\n      return;\n    }\n\n    if (_components && tabDependencies.length && value.type !== \"tabs\") {\n      const ret = tabDependencies.some((el) => el.mapping.includes(value.uniqueId));\n      setShow(ret);\n    }\n  }, [tabDependencies]);\n\n  useEffect(() => {\n    setShow(!isHidden);\n  }, [isHidden]);\n\n  const handleClick = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (isSelect) return;\n\n    setState({ tabsKey: \"base\" });\n    // TODO: 获取当前用户点击的key\n    dispatch({ type: \"component/activeKey\", data: value.uniqueId });\n  };\n\n  // const handleMouseOver = useCallback(\n  //   (e) => {\n  //     e.preventDefault();\n  //     e.stopPropagation();\n\n  //     if (activeKey === value.uniqueId) return;\n  //     // TODO: 获取当前用户点击的key\n  //     throttle(dispatch({ type: \"component/activeKey\", data: value.uniqueId }), 800);\n  //   },\n  //   [activeKey]\n  // );\n\n  // const handleMouseOut = useCallback(\n  //   (e) => {\n  //     e.preventDefault();\n  //     e.stopPropagation();\n\n  //     if (activeKey === value.uniqueId) return;\n  //     // TODO: 获取当前用户点击的key\n  //     throttle(dispatch({ type: \"component/activeKey\", data: \"-\" }), 800);\n  //   },\n  //   [activeKey]\n  // );\n\n  const overwriteStyle = {\n    width: converLayout(width),\n    height: converLayout(height),\n    borderStyle: rest.borderStyle || \"solid\",\n    borderColor: isSelect ? \"#2681ff\" : \"transparent\",\n    background,\n    borderRadius: rest.borderRadius,\n    borderWidth: rest.borderWidth || 2,\n    boxShadow: rest.shadowColor\n      ? `${rest.shadowColor} ${rest.shadowWidth || 0} ${rest.shadowOffset || 0} ${rest.shadowOffset || 0}`\n      : rest.shadowWidth\n  };\n\n  const getSubField = useCallback(\n    (m) => {\n      const prop = getField(value.type);\n      return generator(prop)(m);\n    },\n    [value.type]\n  );\n\n  const onDragHandle = (e, d) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // TODO： 调优节流\n    throttle(\n      setLocations({\n        left: round(d.lastX),\n        top: round(d.lastY)\n      })\n    );\n  };\n\n  const onDragStopHandle = (e, d) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    onValueChange(\n      value.uniqueId,\n      Object.assign(value.data, {\n        left: round(d.lastX),\n        top: round(d.lastY)\n      })\n    );\n  };\n\n  const onResizeHandle = (e, direction, ref, delta, position) => {\n    e.preventDefault();\n    e.stopPropagation();\n    // TODO： 调优节流\n    throttle(\n      onValueChange(\n        value.uniqueId,\n        Object.assign(value.data, {\n          left: round(position.x),\n          top: round(position.y),\n          width: ref.offsetWidth,\n          height: ref.offsetHeight\n        })\n      )\n    );\n  };\n\n  // 阻止事件默认事件、冒泡\n  const onStopPropagation = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    return;\n  };\n\n  const fieldProps = useMemo(\n    () => ({\n      value: value.data,\n      uniqueId: value.uniqueId,\n      type: value.type,\n      options: value.data.config || {},\n      onChange: (val, level = 1) => {\n        onValueChange && onValueChange(value.uniqueId, val, level);\n      }\n    }),\n    [isSelect, onValueChange]\n  );\n\n  return (\n    <Rnd\n      size={{ width: width, height: height }}\n      position={{ x: left, y: top }}\n      id={value.uniqueId}\n      bounds=\"body\"\n      dragAxis=\"both\"\n      disableDragging={isEditing}\n      enableResizing={!isEditing}\n      scale={view.scale}\n      onDragStart={onStopPropagation}\n      onDrag={onDragHandle}\n      onDragStop={onDragStopHandle}\n      onResize={onResizeHandle}\n      onResizeStop={onStopPropagation}\n    >\n      <div className={cx(\"grid-line\", { \"is-active\": isSelect })}>\n        <div className=\"grid-line-top\"></div>\n        <div className=\"grid-line-left\"></div>\n        <div className=\"grid-line-label\">\n          {locations.left}, {locations.top}\n        </div>\n      </div>\n      <div\n        className={classNames}\n        style={overwriteStyle}\n        onClick={handleClick}\n        // onMouseEnter={(e) => {\n        //   handleMouseOver(e);\n        // }}\n        // onMouseLeave={(e) => {\n        //   handleMouseOut(e);\n        // }}\n      >\n        {show ? getSubField(fieldProps) : null}\n        {isSelect ? (\n          <div className=\"widget-circle\">\n            <div className=\"widget-circle__top\">\n              <div className=\"top-left\"></div>\n              <div className=\"top-center\"></div>\n              <div className=\"top-right\"></div>\n            </div>\n            <div className=\"widget-circle__bottom\">\n              <div className=\"bottom-left\"></div>\n              <div className=\"bottom-center\"></div>\n              <div className=\"bottom-right\"></div>\n            </div>\n            <div className=\"widget-circle__left\">\n              <div className=\"left-center\"></div>\n            </div>\n            <div className=\"widget-circle__right\">\n              <div className=\"right-center\"></div>\n            </div>\n          </div>\n        ) : null}\n      </div>\n    </Rnd>\n  );\n};\n\nexport default connect((state) => ({\n  activeKey: state.component.activeKey,\n  tabDependencies: state.tab.dependencies,\n  tabComponent: state.tab.component\n}))(ScreenRenderer);\n"]},"metadata":{},"sourceType":"module"}